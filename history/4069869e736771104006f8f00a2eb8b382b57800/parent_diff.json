{"from": {"secList": ["sec-host-hooks-summary", "sec-host-defined-fields-summary", "sec-triggerpromisereactions", "sec-jobs", "sec-script-records", "sec-promise-resolve-functions", "sec-performpromisethen", "sec-newpromisereactionjob", "sec-promisereaction-records", "sec-newpromiseresolvethenablejob"], "secData": {"sec-host-hooks-summary": {"num": "D.1", "title": "#sec-host-hooks-summary Host Hooks", "html": "<emu-annex id=\"sec-host-hooks-summary\">\n    <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-host-hooks-summary\">#sec-host-hooks-summary</span> Host Hooks</h1>\n    <p><b><emu-xref aoid=\"HostEnqueueFinalizationRegistryCleanupJob\"><a href=\"#sec-host-cleanup-finalization-registry\">HostEnqueueFinalizationRegistryCleanupJob</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostEnqueuePromiseJob\"><a href=\"#sec-hostenqueuepromisejob\">HostEnqueuePromiseJob</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostEnsureCanCompileStrings\"><a href=\"#sec-hostensurecancompilestrings\">HostEnsureCanCompileStrings</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostFinalizeImportMeta\"><a href=\"#sec-hostfinalizeimportmeta\">HostFinalizeImportMeta</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostGetImportMetaProperties\"><a href=\"#sec-hostgetimportmetaproperties\">HostGetImportMetaProperties</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostHasSourceTextAvailable\"><a href=\"#sec-hosthassourcetextavailable\">HostHasSourceTextAvailable</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostImportModuleDynamically\"><a href=\"#sec-hostimportmoduledynamically\">HostImportModuleDynamically</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostPromiseRejectionTracker\"><a href=\"#sec-host-promise-rejection-tracker\">HostPromiseRejectionTracker</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostResolveImportedModule\"><a href=\"#sec-hostresolveimportedmodule\">HostResolveImportedModule</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"InitializeHostDefinedRealm\"><a href=\"#sec-initializehostdefinedrealm\">InitializeHostDefinedRealm</a></emu-xref>(...)</b></p>\n  </emu-annex>\n  "}, "sec-host-defined-fields-summary": {"num": "D.2", "title": "#sec-host-defined-fields-summary Host-defined Fields", "html": "<emu-annex id=\"sec-host-defined-fields-summary\">\n    <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-host-defined-fields-summary\">#sec-host-defined-fields-summary</span> Host-defined Fields</h1>\n    <p>[[HostDefined]] on <emu-xref href=\"#realm\"><a href=\"#realm\">Realm</a></emu-xref> Records: See <emu-xref href=\"#table-21\"><a href=\"#table-21\" class=\"excluded-xref\" excluded-id=\"table-21\">#table-21</a></emu-xref>.</p>\n    <p>[[HostDefined]] on Script Records: See <emu-xref href=\"#table-script-records\"><a href=\"#table-script-records\" class=\"excluded-xref\" excluded-id=\"table-script-records\">#table-script-records</a></emu-xref>.</p>\n    <p>[[HostDefined]] on Module Records: See <emu-xref href=\"#table-36\"><a href=\"#table-36\" class=\"excluded-xref\" excluded-id=\"table-36\">#table-36</a></emu-xref>.</p>\n    <p>[[HostSynchronizesWith]] on Candidate Executions: See <emu-xref href=\"#table-candidate-execution-records\"><a href=\"#table-candidate-execution-records\" class=\"excluded-xref\" excluded-id=\"table-candidate-execution-records\">#table-candidate-execution-records</a></emu-xref>.</p>\n    <p>[[IsHTMLDDA]]: See <emu-xref href=\"#sec-IsHTMLDDA-internal-slot\"><a href=\"#sec-IsHTMLDDA-internal-slot\" class=\"excluded-xref\" excluded-id=\"sec-IsHTMLDDA-internal-slot\">#sec-IsHTMLDDA-internal-slot</a></emu-xref>.</p>\n  </emu-annex>\n  "}, "sec-triggerpromisereactions": {"num": "26.6.1.8", "title": "#sec-triggerpromisereactions TriggerPromiseReactions ( reactions, argument )", "html": "<emu-clause id=\"sec-triggerpromisereactions\" aoid=\"TriggerPromiseReactions\">\n        <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-triggerpromisereactions\">#sec-triggerpromisereactions</span> TriggerPromiseReactions ( <var>reactions</var>, <var>argument</var> )</h1>\n        <p>The abstract operation TriggerPromiseReactions takes arguments <var>reactions</var> (a collection of PromiseReaction Records) and <var>argument</var>. It enqueues a new <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> for each record in <var>reactions</var>. Each such <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> processes the [[Type]] and [[Handler]] of the PromiseReaction <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">Record</a></emu-xref>, and if the [[Handler]] is a function, calls it passing the given argument. If the [[Handler]] is <emu-val>undefined</emu-val>, the behaviour is determined by the [[Type]]. It performs the following steps when called:</p>\n        <emu-alg><ol><li>For each <var>reaction</var> in <var>reactions</var>, in original insertion order, do<ol><li>Let <var>job</var> be <emu-xref aoid=\"NewPromiseReactionJob\"><a href=\"#sec-newpromisereactionjob\">NewPromiseReactionJob</a></emu-xref>(<var>reaction</var>, <var>argument</var>).</li><li>Perform <emu-xref aoid=\"HostEnqueuePromiseJob\"><a href=\"#sec-hostenqueuepromisejob\">HostEnqueuePromiseJob</a></emu-xref>(<var>job</var>.[[Job]], <var>job</var>.[[Realm]]).</li></ol></li><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>\n      </emu-clause>\n\n      "}, "sec-jobs": {"num": "8.4", "title": "#sec-jobs Jobs and Host Operations to Enqueue Jobs", "html": "<emu-clause id=\"sec-jobs\" oldids=\"sec-jobs-and-job-queues,sec-enqueuejob,sec-runjobs,job-queue\">\n    <span id=\"job-queue\"></span><span id=\"sec-runjobs\"></span><span id=\"sec-enqueuejob\"></span><span id=\"sec-jobs-and-job-queues\"></span><h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-jobs\">#sec-jobs</span> Jobs and Host Operations to Enqueue Jobs</h1>\n    <p>A <dfn id=\"job\">Job</dfn> is an <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> with no parameters that initiates an ECMAScript computation when no other ECMAScript computation is currently in progress.</p>\n    <p>Jobs are scheduled for execution by ECMAScript <emu-xref href=\"#host\"><a href=\"#host\">host</a></emu-xref> environments. This specification describes the <emu-xref href=\"#host-hook\"><a href=\"#host-hook\">host hook</a></emu-xref> <emu-xref aoid=\"HostEnqueuePromiseJob\"><a href=\"#sec-hostenqueuepromisejob\">HostEnqueuePromiseJob</a></emu-xref> to schedule one kind of job; hosts may define additional <emu-xref href=\"#sec-algorithm-conventions-abstract-operations\"><a href=\"#sec-algorithm-conventions-abstract-operations\">abstract operations</a></emu-xref> which schedule jobs. Such operations accept a <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> as the parameter and schedule it to be performed at some future time. Their implementations must conform to the following requirements:</p>\n\n    <ul>\n      <li>At some future point in time, when there is no <emu-xref href=\"#running-execution-context\"><a href=\"#running-execution-context\">running execution context</a></emu-xref> and the <emu-xref href=\"#execution-context-stack\"><a href=\"#execution-context-stack\">execution context stack</a></emu-xref> is empty, the implementation must:\n        <ol>\n          <li>Perform any <emu-xref href=\"#host-defined\"><a href=\"#host-defined\">host-defined</a></emu-xref> preparation steps.</li>\n          <li><emu-xref aoid=\"Invoke\"><a href=\"#sec-invoke\">Invoke</a></emu-xref> the <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref>.</li>\n          <li>Perform any <emu-xref href=\"#host-defined\"><a href=\"#host-defined\">host-defined</a></emu-xref> cleanup steps, after which the <emu-xref href=\"#execution-context-stack\"><a href=\"#execution-context-stack\">execution context stack</a></emu-xref> must be empty.</li>\n        </ol>\n      </li>\n      <li>Only one <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> may be actively undergoing evaluation at any point in time.</li>\n      <li>Once evaluation of a <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> starts, it must run to completion before evaluation of any other <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> starts.</li>\n      <li>The <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> must return a normal completion, implementing its own handling of errors.</li>\n    </ul>\n\n    <emu-note><span class=\"note\">Note 1</span><div class=\"note-contents\">\n      <emu-xref href=\"#host\"><a href=\"#host\">Host</a></emu-xref> environments are not required to treat Jobs uniformly with respect to scheduling. For example, web browsers and Node.js treat Promise-handling Jobs as a higher priority than other work; future features may add Jobs that are not treated at such a high priority.\n    </div></emu-note>\n\n    <p>At any particular time, <var>scriptOrModule</var> (a <emu-xref href=\"#script-record\"><a href=\"#script-record\">Script Record</a></emu-xref>, a <emu-xref href=\"#sec-abstract-module-records\"><a href=\"#sec-abstract-module-records\">Module Record</a></emu-xref>, or <emu-val>null</emu-val>) is the <dfn id=\"job-activescriptormodule\">active script or module</dfn> if all of the following conditions are true:</p>\n    <ul>\n      <li><emu-xref aoid=\"GetActiveScriptOrModule\"><a href=\"#sec-getactivescriptormodule\">GetActiveScriptOrModule</a></emu-xref>() is <var>scriptOrModule</var>.</li>\n      <li>If <var>scriptOrModule</var> is a <emu-xref href=\"#script-record\"><a href=\"#script-record\">Script Record</a></emu-xref> or <emu-xref href=\"#sec-abstract-module-records\"><a href=\"#sec-abstract-module-records\">Module Record</a></emu-xref>, let <var>ec</var> be the topmost <emu-xref href=\"#sec-execution-contexts\"><a href=\"#sec-execution-contexts\">execution context</a></emu-xref> on the <emu-xref href=\"#execution-context-stack\"><a href=\"#execution-context-stack\">execution context stack</a></emu-xref> whose ScriptOrModule component is <var>scriptOrModule</var>. The <emu-xref href=\"#realm\"><a href=\"#realm\">Realm</a></emu-xref> component of <var>ec</var> is <var>scriptOrModule</var>.[[Realm]].</li>\n    </ul>\n\n    <p>At any particular time, an execution is <dfn id=\"job-preparedtoevaluatecode\">prepared to evaluate ECMAScript code</dfn> if all of the following conditions are true:</p>\n    <ul>\n      <li>The <emu-xref href=\"#execution-context-stack\"><a href=\"#execution-context-stack\">execution context stack</a></emu-xref> is not empty.</li>\n      <li>The <emu-xref href=\"#realm\"><a href=\"#realm\">Realm</a></emu-xref> component of the topmost <emu-xref href=\"#sec-execution-contexts\"><a href=\"#sec-execution-contexts\">execution context</a></emu-xref> on the <emu-xref href=\"#execution-context-stack\"><a href=\"#execution-context-stack\">execution context stack</a></emu-xref> is a <emu-xref href=\"#realm-record\"><a href=\"#realm-record\">Realm Record</a></emu-xref>.</li>\n    </ul>\n\n    <emu-note><span class=\"note\">Note 2</span><div class=\"note-contents\">\n      <p><emu-xref href=\"#host\"><a href=\"#host\">Host</a></emu-xref> environments may prepare an execution to evaluate code by pushing execution contexts onto the <emu-xref href=\"#execution-context-stack\"><a href=\"#execution-context-stack\">execution context stack</a></emu-xref>. The specific steps are <emu-xref href=\"#implementation-defined\"><a href=\"#implementation-defined\">implementation-defined</a></emu-xref>.</p>\n      <p>The specific choice of <emu-xref href=\"#realm\"><a href=\"#realm\">Realm</a></emu-xref> is up to the <emu-xref href=\"#host-environment\"><a href=\"#host-environment\">host environment</a></emu-xref>. This initial <emu-xref href=\"#sec-execution-contexts\"><a href=\"#sec-execution-contexts\">execution context</a></emu-xref> and <emu-xref href=\"#realm\"><a href=\"#realm\">Realm</a></emu-xref> is only in use before any callback function is invoked. When a callback function related to a <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref>, like a Promise handler, is invoked, the invocation pushes its own <emu-xref href=\"#sec-execution-contexts\"><a href=\"#sec-execution-contexts\">execution context</a></emu-xref> and <emu-xref href=\"#realm\"><a href=\"#realm\">Realm</a></emu-xref>.</p>\n    </div></emu-note>\n\n    <p>Particular kinds of Jobs have additional conformance requirements.</p>\n\n    <div id=\"excluded-sec-hostenqueuepromisejob\"><h1><span class=\"secnum\">8.4.1</span>#sec-hostenqueuepromisejob HostEnqueuePromiseJob ( job, realm )</h1>...</div></emu-clause>\n\n  "}, "sec-script-records": {"num": "15.1.8", "title": "#sec-script-records Script Records", "html": "<emu-clause id=\"sec-script-records\">\n      <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-script-records\">#sec-script-records</span> Script Records</h1>\n\n      <p>A <dfn id=\"script-record\">Script Record</dfn> encapsulates information about a script being evaluated. Each script record contains the fields listed in <emu-xref href=\"#table-script-records\"><a href=\"#table-script-records\" class=\"excluded-xref\" excluded-id=\"table-script-records\">#table-script-records</a></emu-xref>.</p>\n\n      <emu-table id=\"table-script-records\" caption=\"Script Record Fields\"><figure><figcaption><span class=\"excluded-caption-num\" excluded-id=\"table-script-records\">#table-script-records</span>: <emu-xref href=\"#script-record\"><a href=\"#script-record\">Script Record</a></emu-xref> Fields</figcaption>\n        <table>\n          <thead>\n          <tr>\n            <th>\n              Field Name\n            </th>\n            <th>\n              Value Type\n            </th>\n            <th>\n              Meaning\n            </th>\n          </tr>\n          </thead>\n          <tbody>\n          <tr>\n            <td>\n              [[Realm]]\n            </td>\n            <td>\n              <emu-xref href=\"#realm-record\"><a href=\"#realm-record\">Realm Record</a></emu-xref> | <emu-val>undefined</emu-val>\n            </td>\n            <td>\n              The <emu-xref href=\"#realm\"><a href=\"#realm\">realm</a></emu-xref> within which this script was created. <emu-val>undefined</emu-val> if not yet assigned.\n            </td>\n          </tr>\n          <tr>\n            <td>\n              [[Environment]]\n            </td>\n            <td>\n              <emu-xref href=\"#sec-environment-records\"><a href=\"#sec-environment-records\">Environment Record</a></emu-xref> | <emu-val>undefined</emu-val>\n            </td>\n            <td>\n              The <emu-xref href=\"#sec-environment-records\"><a href=\"#sec-environment-records\">Environment Record</a></emu-xref> containing the top level bindings for this script. This field is set when the script is instantiated.\n            </td>\n          </tr>\n          <tr>\n            <td>\n              [[ECMAScriptCode]]\n            </td>\n            <td>\n              a <emu-xref href=\"#sec-syntactic-grammar\"><a href=\"#sec-syntactic-grammar\">Parse Node</a></emu-xref>\n            </td>\n            <td>\n              The result of parsing the source text of this script using <emu-nt><a href=\"#prod-Script\">Script</a></emu-nt> as the <emu-xref href=\"#sec-context-free-grammars\"><a href=\"#sec-context-free-grammars\">goal symbol</a></emu-xref>.\n            </td>\n          </tr>\n          <tr>\n            <td>\n              [[HostDefined]]\n            </td>\n            <td>\n              Any, default value is <emu-val>undefined</emu-val>.\n            </td>\n            <td>\n              Field reserved for use by <emu-xref href=\"#host\"><a href=\"#host\">host</a></emu-xref> environments that need to associate additional information with a script.\n            </td>\n          </tr>\n          </tbody>\n        </table>\n      </figure></emu-table>\n    </emu-clause>\n\n    "}, "sec-promise-resolve-functions": {"num": "26.6.1.3.2", "title": "#sec-promise-resolve-functions Promise Resolve Functions", "html": "<emu-clause id=\"sec-promise-resolve-functions\">\n          <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-promise-resolve-functions\">#sec-promise-resolve-functions</span> Promise Resolve Functions</h1>\n          <p>A promise resolve function is an anonymous built-in function that has [[Promise]] and [[AlreadyResolved]] internal slots.</p>\n          <p>When a promise resolve function is called with argument <var>resolution</var>, the following steps are taken:</p>\n          <emu-alg><ol><li>Let <var>F</var> be the <emu-xref href=\"#active-function-object\"><a href=\"#active-function-object\">active function object</a></emu-xref>.</li><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <var>F</var> has a [[Promise]] internal slot whose value is an Object.</li><li>Let <var>promise</var> be <var>F</var>.[[Promise]].</li><li>Let <var>alreadyResolved</var> be <var>F</var>.[[AlreadyResolved]].</li><li>If <var>alreadyResolved</var>.[[Value]] is <emu-val>true</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Set <var>alreadyResolved</var>.[[Value]] to <emu-val>true</emu-val>.</li><li>If <emu-xref aoid=\"SameValue\"><a href=\"#sec-samevalue\">SameValue</a></emu-xref>(<var>resolution</var>, <var>promise</var>) is <emu-val>true</emu-val>, then<ol><li>Let <var>selfResolutionError</var> be a newly created <emu-val>TypeError</emu-val> object.</li><li>Return <emu-xref aoid=\"RejectPromise\"><a href=\"#sec-rejectpromise\">RejectPromise</a></emu-xref>(<var>promise</var>, <var>selfResolutionError</var>).</li></ol></li><li>If <emu-xref aoid=\"Type\"><a href=\"#sec-ecmascript-data-types-and-values\">Type</a></emu-xref>(<var>resolution</var>) is not Object, then<ol><li>Return <emu-xref aoid=\"FulfillPromise\"><a href=\"#sec-fulfillpromise\">FulfillPromise</a></emu-xref>(<var>promise</var>, <var>resolution</var>).</li></ol></li><li>Let <var>then</var> be <emu-xref aoid=\"Get\"><a href=\"#sec-get-o-p\">Get</a></emu-xref>(<var>resolution</var>, <emu-val>\"then\"</emu-val>).</li><li>If <var>then</var> is an <emu-xref href=\"#sec-completion-record-specification-type\"><a href=\"#sec-completion-record-specification-type\">abrupt completion</a></emu-xref>, then<ol><li>Return <emu-xref aoid=\"RejectPromise\"><a href=\"#sec-rejectpromise\">RejectPromise</a></emu-xref>(<var>promise</var>, <var>then</var>.[[Value]]).</li></ol></li><li>Let <var>thenAction</var> be <var>then</var>.[[Value]].</li><li>If <emu-xref aoid=\"IsCallable\"><a href=\"#sec-iscallable\">IsCallable</a></emu-xref>(<var>thenAction</var>) is <emu-val>false</emu-val>, then<ol><li>Return <emu-xref aoid=\"FulfillPromise\"><a href=\"#sec-fulfillpromise\">FulfillPromise</a></emu-xref>(<var>promise</var>, <var>resolution</var>).</li></ol></li><li>Let <var>job</var> be <emu-xref aoid=\"NewPromiseResolveThenableJob\"><a href=\"#sec-newpromiseresolvethenablejob\">NewPromiseResolveThenableJob</a></emu-xref>(<var>promise</var>, <var>resolution</var>, <var>thenAction</var>).</li><li>Perform <emu-xref aoid=\"HostEnqueuePromiseJob\"><a href=\"#sec-hostenqueuepromisejob\">HostEnqueuePromiseJob</a></emu-xref>(<var>job</var>.[[Job]], <var>job</var>.[[Realm]]).</li><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>\n          <p>The <emu-val>\"length\"</emu-val> property of a promise resolve function is 1.</p>\n        </emu-clause>\n      "}, "sec-performpromisethen": {"num": "26.6.5.4.1", "title": "#sec-performpromisethen PerformPromiseThen ( promise, onFulfilled, onRejected [ , resultCapability ] )", "html": "<emu-clause id=\"sec-performpromisethen\" aoid=\"PerformPromiseThen\">\n          <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-performpromisethen\">#sec-performpromisethen</span> PerformPromiseThen ( <var>promise</var>, <var>onFulfilled</var>, <var>onRejected</var> [ , <var>resultCapability</var> ] )</h1>\n          <p>The abstract operation PerformPromiseThen takes arguments <var>promise</var>, <var>onFulfilled</var>, and <var>onRejected</var> and optional argument <var>resultCapability</var> (a <emu-xref href=\"#sec-promisecapability-records\"><a href=\"#sec-promisecapability-records\">PromiseCapability Record</a></emu-xref>). It performs the &#8220;then&#8221; operation on <var>promise</var> using <var>onFulfilled</var> and <var>onRejected</var> as its settlement actions. If <var>resultCapability</var> is passed, the result is stored by updating <var>resultCapability</var>'s promise. If it is not passed, then PerformPromiseThen is being called by a specification-internal operation where the result does not matter. It performs the following steps when called:</p>\n          <emu-alg><ol><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <emu-xref aoid=\"IsPromise\"><a href=\"#sec-ispromise\">IsPromise</a></emu-xref>(<var>promise</var>) is <emu-val>true</emu-val>.</li><li>If <var>resultCapability</var> is not present, then<ol><li>Set <var>resultCapability</var> to <emu-val>undefined</emu-val>.</li></ol></li><li>If <emu-xref aoid=\"IsCallable\"><a href=\"#sec-iscallable\">IsCallable</a></emu-xref>(<var>onFulfilled</var>) is <emu-val>false</emu-val>, then<ol><li>Set <var>onFulfilled</var> to <emu-val>undefined</emu-val>.</li></ol></li><li>If <emu-xref aoid=\"IsCallable\"><a href=\"#sec-iscallable\">IsCallable</a></emu-xref>(<var>onRejected</var>) is <emu-val>false</emu-val>, then<ol><li>Set <var>onRejected</var> to <emu-val>undefined</emu-val>.</li></ol></li><li>Let <var>fulfillReaction</var> be the PromiseReaction { [[Capability]]: <var>resultCapability</var>, [[Type]]: <emu-const>Fulfill</emu-const>, [[Handler]]: <var>onFulfilled</var> }.</li><li>Let <var>rejectReaction</var> be the PromiseReaction { [[Capability]]: <var>resultCapability</var>, [[Type]]: <emu-const>Reject</emu-const>, [[Handler]]: <var>onRejected</var> }.</li><li>If <var>promise</var>.[[PromiseState]] is <emu-const>pending</emu-const>, then<ol><li>Append <var>fulfillReaction</var> as the last element of the <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">List</a></emu-xref> that is <var>promise</var>.[[PromiseFulfillReactions]].</li><li>Append <var>rejectReaction</var> as the last element of the <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">List</a></emu-xref> that is <var>promise</var>.[[PromiseRejectReactions]].</li></ol></li><li>Else if <var>promise</var>.[[PromiseState]] is <emu-const>fulfilled</emu-const>, then<ol><li>Let <var>value</var> be <var>promise</var>.[[PromiseResult]].</li><li>Let <var>fulfillJob</var> be <emu-xref aoid=\"NewPromiseReactionJob\"><a href=\"#sec-newpromisereactionjob\">NewPromiseReactionJob</a></emu-xref>(<var>fulfillReaction</var>, <var>value</var>).</li><li>Perform <emu-xref aoid=\"HostEnqueuePromiseJob\"><a href=\"#sec-hostenqueuepromisejob\">HostEnqueuePromiseJob</a></emu-xref>(<var>fulfillJob</var>.[[Job]], <var>fulfillJob</var>.[[Realm]]).</li></ol></li><li>Else,<ol><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: The value of <var>promise</var>.[[PromiseState]] is <emu-const>rejected</emu-const>.</li><li>Let <var>reason</var> be <var>promise</var>.[[PromiseResult]].</li><li>If <var>promise</var>.[[PromiseIsHandled]] is <emu-val>false</emu-val>, perform <emu-xref aoid=\"HostPromiseRejectionTracker\"><a href=\"#sec-host-promise-rejection-tracker\">HostPromiseRejectionTracker</a></emu-xref>(<var>promise</var>, <emu-val>\"handle\"</emu-val>).</li><li>Let <var>rejectJob</var> be <emu-xref aoid=\"NewPromiseReactionJob\"><a href=\"#sec-newpromisereactionjob\">NewPromiseReactionJob</a></emu-xref>(<var>rejectReaction</var>, <var>reason</var>).</li><li>Perform <emu-xref aoid=\"HostEnqueuePromiseJob\"><a href=\"#sec-hostenqueuepromisejob\">HostEnqueuePromiseJob</a></emu-xref>(<var>rejectJob</var>.[[Job]], <var>rejectJob</var>.[[Realm]]).</li></ol></li><li>Set <var>promise</var>.[[PromiseIsHandled]] to <emu-val>true</emu-val>.</li><li>If <var>resultCapability</var> is <emu-val>undefined</emu-val>, then<ol><li>Return <emu-val>undefined</emu-val>.</li></ol></li><li>Else,<ol><li>Return <var>resultCapability</var>.[[Promise]].</li></ol></li></ol></emu-alg>\n        </emu-clause>\n      "}, "sec-newpromisereactionjob": {"num": "26.6.2.1", "title": "#sec-newpromisereactionjob NewPromiseReactionJob ( reaction, argument )", "html": "<emu-clause id=\"sec-newpromisereactionjob\" aoid=\"NewPromiseReactionJob\" oldids=\"sec-promisereactionjob\">\n        <span id=\"sec-promisereactionjob\"></span><h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-newpromisereactionjob\">#sec-newpromisereactionjob</span> NewPromiseReactionJob ( <var>reaction</var>, <var>argument</var> )</h1>\n        <p>The abstract operation NewPromiseReactionJob takes arguments <var>reaction</var> and <var>argument</var>. It returns a new <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> that applies the appropriate handler to the incoming value, and uses the handler's return value to resolve or reject the derived promise associated with that handler. It performs the following steps when called:</p>\n        <emu-alg><ol><li>Let <var>job</var> be a new <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> with no parameters that captures <var>reaction</var> and <var>argument</var> and performs the following steps when called:<ol><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <var>reaction</var> is a PromiseReaction <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">Record</a></emu-xref>.</li><li>Let <var>promiseCapability</var> be <var>reaction</var>.[[Capability]].</li><li>Let <var>type</var> be <var>reaction</var>.[[Type]].</li><li>Let <var>handler</var> be <var>reaction</var>.[[Handler]].</li><li>If <var>handler</var> is <emu-val>undefined</emu-val>, then<ol><li>If <var>type</var> is <emu-const>Fulfill</emu-const>, let <var>handlerResult</var> be <emu-xref aoid=\"NormalCompletion\"><a href=\"#sec-normalcompletion\">NormalCompletion</a></emu-xref>(<var>argument</var>).</li><li>Else,<ol><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <var>type</var> is <emu-const>Reject</emu-const>.</li><li>Let <var>handlerResult</var> be <emu-xref aoid=\"ThrowCompletion\"><a href=\"#sec-throwcompletion\">ThrowCompletion</a></emu-xref>(<var>argument</var>).</li></ol></li></ol></li><li>Else, let <var>handlerResult</var> be <emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>handler</var>, <emu-val>undefined</emu-val>, &#171; <var>argument</var> &#187;).</li><li>If <var>promiseCapability</var> is <emu-val>undefined</emu-val>, then<ol><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <var>handlerResult</var> is not an <emu-xref href=\"#sec-completion-record-specification-type\"><a href=\"#sec-completion-record-specification-type\">abrupt completion</a></emu-xref>.</li><li>Return <emu-xref aoid=\"NormalCompletion\"><a href=\"#sec-normalcompletion\">NormalCompletion</a></emu-xref>(<emu-const>empty</emu-const>).</li></ol></li><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <var>promiseCapability</var> is a <emu-xref href=\"#sec-promisecapability-records\"><a href=\"#sec-promisecapability-records\">PromiseCapability Record</a></emu-xref>.</li><li>If <var>handlerResult</var> is an <emu-xref href=\"#sec-completion-record-specification-type\"><a href=\"#sec-completion-record-specification-type\">abrupt completion</a></emu-xref>, then<ol><li>Let <var>status</var> be <emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>promiseCapability</var>.[[Reject]], <emu-val>undefined</emu-val>, &#171; <var>handlerResult</var>.[[Value]] &#187;).</li></ol></li><li>Else,<ol><li>Let <var>status</var> be <emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>promiseCapability</var>.[[Resolve]], <emu-val>undefined</emu-val>, &#171; <var>handlerResult</var>.[[Value]] &#187;).</li></ol></li><li>Return <emu-xref aoid=\"Completion\"><a href=\"#sec-completion-record-specification-type\">Completion</a></emu-xref>(<var>status</var>).</li></ol></li><li>Let <var>handlerRealm</var> be <emu-val>null</emu-val>.</li><li>If <var>reaction</var>.[[Handler]] is not <emu-val>undefined</emu-val>, then<ol><li>Let <var>getHandlerRealmResult</var> be <emu-xref aoid=\"GetFunctionRealm\"><a href=\"#sec-getfunctionrealm\">GetFunctionRealm</a></emu-xref>(<var>reaction</var>.[[Handler]]).</li><li>If <var>getHandlerRealmResult</var> is a normal completion, then set <var>handlerRealm</var> to <var>getHandlerRealmResult</var>.[[Value]].</li><li>Else, set <var>handlerRealm</var> to <emu-xref href=\"#current-realm\"><a href=\"#current-realm\">the current Realm Record</a></emu-xref>.</li><li>NOTE: <var>handlerRealm</var> is never <emu-val>null</emu-val> unless the handler is <emu-val>undefined</emu-val>. When the handler is a revoked Proxy and no ECMAScript code runs, <var>handlerRealm</var> is used to create error objects.</li></ol></li><li>Return the <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">Record</a></emu-xref> { [[Job]]: <var>job</var>, [[Realm]]: <var>handlerRealm</var> }.</li></ol></emu-alg>\n      </emu-clause>\n\n      "}, "sec-promisereaction-records": {"num": "26.6.1.2", "title": "#sec-promisereaction-records PromiseReaction Records", "html": "<emu-clause id=\"sec-promisereaction-records\">\n        <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-promisereaction-records\">#sec-promisereaction-records</span> PromiseReaction Records</h1>\n        <p>The PromiseReaction is a <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">Record</a></emu-xref> value used to store information about how a promise should react when it becomes resolved or rejected with a given value. PromiseReaction records are created by the <emu-xref aoid=\"PerformPromiseThen\"><a href=\"#sec-performpromisethen\">PerformPromiseThen</a></emu-xref> abstract operation, and are used by the <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> returned by <emu-xref aoid=\"NewPromiseReactionJob\"><a href=\"#sec-newpromisereactionjob\">NewPromiseReactionJob</a></emu-xref>.</p>\n        <p>PromiseReaction records have the fields listed in <emu-xref href=\"#table-58\"><a href=\"#table-58\" class=\"excluded-xref\" excluded-id=\"table-58\">#table-58</a></emu-xref>.</p>\n        <emu-table id=\"table-58\" caption=\"PromiseReaction Record Fields\"><figure><figcaption><span class=\"excluded-caption-num\" excluded-id=\"table-58\">#table-58</span>: PromiseReaction <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">Record</a></emu-xref> Fields</figcaption>\n          <table>\n            <tbody>\n            <tr>\n              <th>\n                Field Name\n              </th>\n              <th>\n                Value\n              </th>\n              <th>\n                Meaning\n              </th>\n            </tr>\n            <tr>\n              <td>\n                [[Capability]]\n              </td>\n              <td>\n                A <emu-xref href=\"#sec-promisecapability-records\"><a href=\"#sec-promisecapability-records\">PromiseCapability Record</a></emu-xref>, or <emu-val>undefined</emu-val>\n              </td>\n              <td>\n                The capabilities of the promise for which this record provides a reaction handler.\n              </td>\n            </tr>\n            <tr>\n              <td>\n                [[Type]]\n              </td>\n              <td>\n                <emu-const>Fulfill</emu-const> | <emu-const>Reject</emu-const>\n              </td>\n              <td>\n                The [[Type]] is used when [[Handler]] is <emu-val>undefined</emu-val> to allow for behaviour specific to the settlement type.\n              </td>\n            </tr>\n            <tr>\n              <td>\n                [[Handler]]\n              </td>\n              <td>\n                A <emu-xref href=\"#function-object\"><a href=\"#function-object\">function object</a></emu-xref> or <emu-val>undefined</emu-val>.\n              </td>\n              <td>\n                The function that should be applied to the incoming value, and whose return value will govern what happens to the derived promise. If [[Handler]] is <emu-val>undefined</emu-val>, a function that depends on the value of [[Type]] will be used instead.\n              </td>\n            </tr>\n            </tbody>\n          </table>\n        </figure></emu-table>\n      </emu-clause>\n\n      "}, "sec-newpromiseresolvethenablejob": {"num": "26.6.2.2", "title": "#sec-newpromiseresolvethenablejob NewPromiseResolveThenableJob ( promiseToResolve, thenable, then )", "html": "<emu-clause id=\"sec-newpromiseresolvethenablejob\" aoid=\"NewPromiseResolveThenableJob\" oldids=\"sec-promiseresolvethenablejob\">\n        <span id=\"sec-promiseresolvethenablejob\"></span><h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-newpromiseresolvethenablejob\">#sec-newpromiseresolvethenablejob</span> NewPromiseResolveThenableJob ( <var>promiseToResolve</var>, <var>thenable</var>, <var>then</var> )</h1>\n        <p>The abstract operation NewPromiseResolveThenableJob takes arguments <var>promiseToResolve</var>, <var>thenable</var>, and <var>then</var>. It performs the following steps when called:</p>\n        <emu-alg><ol><li>Let <var>job</var> be a new <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> with no parameters that captures <var>promiseToResolve</var>, <var>thenable</var>, and <var>then</var> and performs the following steps when called:<ol><li>Let <var>resolvingFunctions</var> be <emu-xref aoid=\"CreateResolvingFunctions\"><a href=\"#sec-createresolvingfunctions\">CreateResolvingFunctions</a></emu-xref>(<var>promiseToResolve</var>).</li><li>Let <var>thenCallResult</var> be <emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>then</var>, <var>thenable</var>, &#171; <var>resolvingFunctions</var>.[[Resolve]], <var>resolvingFunctions</var>.[[Reject]] &#187;).</li><li>If <var>thenCallResult</var> is an <emu-xref href=\"#sec-completion-record-specification-type\"><a href=\"#sec-completion-record-specification-type\">abrupt completion</a></emu-xref>, then<ol><li>Let <var>status</var> be <emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>resolvingFunctions</var>.[[Reject]], <emu-val>undefined</emu-val>, &#171; <var>thenCallResult</var>.[[Value]] &#187;).</li><li>Return <emu-xref aoid=\"Completion\"><a href=\"#sec-completion-record-specification-type\">Completion</a></emu-xref>(<var>status</var>).</li></ol></li><li>Return <emu-xref aoid=\"Completion\"><a href=\"#sec-completion-record-specification-type\">Completion</a></emu-xref>(<var>thenCallResult</var>).</li></ol></li><li>Let <var>getThenRealmResult</var> be <emu-xref aoid=\"GetFunctionRealm\"><a href=\"#sec-getfunctionrealm\">GetFunctionRealm</a></emu-xref>(<var>then</var>).</li><li>If <var>getThenRealmResult</var> is a normal completion, then let <var>thenRealm</var> be <var>getThenRealmResult</var>.[[Value]].</li><li>Else, let <var>thenRealm</var> be <emu-xref href=\"#current-realm\"><a href=\"#current-realm\">the current Realm Record</a></emu-xref>.</li><li>NOTE: <var>thenRealm</var> is never <emu-val>null</emu-val>. When <var>then</var> is a revoked Proxy and no code runs, <var>thenRealm</var> is used to create error objects.</li><li>Return the <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">Record</a></emu-xref> { [[Job]]: <var>job</var>, [[Realm]]: <var>thenRealm</var> }.</li></ol></emu-alg>\n        <emu-note><span class=\"note\">Note</span><div class=\"note-contents\">\n          <p>This <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> uses the supplied thenable and its <code>then</code> method to resolve the given promise. This process must take place as a <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> to ensure that the evaluation of the <code>then</code> method occurs after evaluation of any surrounding code has completed.</p>\n        </div></emu-note>\n      </emu-clause>\n    "}}, "figData": {"table-2": "Table 3", "table-3": "Table 4", "table-5": "Table 6", "table-21": "Table 22", "table-script-records": "Table 37", "table-36": "Table 38", "table-58": "Table 77", "table-candidate-execution-records": "Table 84"}}, "to": {"secList": ["sec-host-hooks-summary", "sec-host-defined-fields-summary", "sec-hostcalljobcallback", "sec-hostmakejobcallback", "sec-triggerpromisereactions", "sec-jobcallback-records", "sec-jobs", "sec-script-records", "sec-promise-resolve-functions", "sec-performpromisethen", "sec-newpromisereactionjob", "sec-promisereaction-records", "sec-newpromiseresolvethenablejob"], "secData": {"sec-host-hooks-summary": {"num": "D.1", "title": "#sec-host-hooks-summary Host Hooks", "html": "<emu-annex id=\"sec-host-hooks-summary\">\n    <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-host-hooks-summary\">#sec-host-hooks-summary</span> Host Hooks</h1>\n    <p><b><emu-xref aoid=\"HostCallJobCallback\"><a href=\"#sec-hostcalljobcallback\">HostCallJobCallback</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostEnqueueFinalizationRegistryCleanupJob\"><a href=\"#sec-host-cleanup-finalization-registry\">HostEnqueueFinalizationRegistryCleanupJob</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostEnqueuePromiseJob\"><a href=\"#sec-hostenqueuepromisejob\">HostEnqueuePromiseJob</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostEnsureCanCompileStrings\"><a href=\"#sec-hostensurecancompilestrings\">HostEnsureCanCompileStrings</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostFinalizeImportMeta\"><a href=\"#sec-hostfinalizeimportmeta\">HostFinalizeImportMeta</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostGetImportMetaProperties\"><a href=\"#sec-hostgetimportmetaproperties\">HostGetImportMetaProperties</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostHasSourceTextAvailable\"><a href=\"#sec-hosthassourcetextavailable\">HostHasSourceTextAvailable</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostImportModuleDynamically\"><a href=\"#sec-hostimportmoduledynamically\">HostImportModuleDynamically</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostMakeJobCallback\"><a href=\"#sec-hostmakejobcallback\">HostMakeJobCallback</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostPromiseRejectionTracker\"><a href=\"#sec-host-promise-rejection-tracker\">HostPromiseRejectionTracker</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"HostResolveImportedModule\"><a href=\"#sec-hostresolveimportedmodule\">HostResolveImportedModule</a></emu-xref>(...)</b></p>\n    <p><b><emu-xref aoid=\"InitializeHostDefinedRealm\"><a href=\"#sec-initializehostdefinedrealm\">InitializeHostDefinedRealm</a></emu-xref>(...)</b></p>\n  </emu-annex>\n  "}, "sec-host-defined-fields-summary": {"num": "D.2", "title": "#sec-host-defined-fields-summary Host-defined Fields", "html": "<emu-annex id=\"sec-host-defined-fields-summary\">\n    <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-host-defined-fields-summary\">#sec-host-defined-fields-summary</span> Host-defined Fields</h1>\n    <p>[[HostDefined]] on <emu-xref href=\"#realm\"><a href=\"#realm\">Realm</a></emu-xref> Records: See <emu-xref href=\"#table-21\"><a href=\"#table-21\" class=\"excluded-xref\" excluded-id=\"table-21\">#table-21</a></emu-xref>.</p>\n    <p>[[HostDefined]] on Script Records: See <emu-xref href=\"#table-script-records\"><a href=\"#table-script-records\" class=\"excluded-xref\" excluded-id=\"table-script-records\">#table-script-records</a></emu-xref>.</p>\n    <p>[[HostDefined]] on Module Records: See <emu-xref href=\"#table-36\"><a href=\"#table-36\" class=\"excluded-xref\" excluded-id=\"table-36\">#table-36</a></emu-xref>.</p>\n    <p>[[HostDefined]] on JobCallback Records: See <emu-xref href=\"#table-jobcallback-records\"><a href=\"#table-jobcallback-records\" class=\"excluded-xref\" excluded-id=\"table-jobcallback-records\">#table-jobcallback-records</a></emu-xref>.</p>\n    <p>[[HostSynchronizesWith]] on Candidate Executions: See <emu-xref href=\"#table-candidate-execution-records\"><a href=\"#table-candidate-execution-records\" class=\"excluded-xref\" excluded-id=\"table-candidate-execution-records\">#table-candidate-execution-records</a></emu-xref>.</p>\n    <p>[[IsHTMLDDA]]: See <emu-xref href=\"#sec-IsHTMLDDA-internal-slot\"><a href=\"#sec-IsHTMLDDA-internal-slot\" class=\"excluded-xref\" excluded-id=\"sec-IsHTMLDDA-internal-slot\">#sec-IsHTMLDDA-internal-slot</a></emu-xref>.</p>\n  </emu-annex>\n  "}, "sec-hostcalljobcallback": {"num": "8.4.3", "title": "#sec-hostcalljobcallback HostCallJobCallback ( jobCallback, V, argumentsList )", "html": "<emu-clause id=\"sec-hostcalljobcallback\" aoid=\"HostCallJobCallback\">\n      <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-hostcalljobcallback\">#sec-hostcalljobcallback</span> HostCallJobCallback ( <var>jobCallback</var>, <var>V</var>, <var>argumentsList</var> )</h1>\n      <p>HostCallJobCallback is a <emu-xref href=\"#host-defined\"><a href=\"#host-defined\">host-defined</a></emu-xref> abstract operation that takes arguments <var>jobCallback</var> (a <emu-xref href=\"#sec-jobcallback-records\"><a href=\"#sec-jobcallback-records\">JobCallback Record</a></emu-xref>), <var>V</var> (an <emu-xref href=\"#sec-ecmascript-language-types\"><a href=\"#sec-ecmascript-language-types\">ECMAScript language value</a></emu-xref>), and <var>argumentsList</var> (a <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">List</a></emu-xref> of ECMAScript language values).</p>\n      <p>The implementation of HostCallJobCallback must conform to the following requirements:</p>\n      <ul>\n        <li>It must always perform and return the result of <emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>jobCallback</var>.[[Callback]], <var>V</var>, <var>argumentsList</var>).</li>\n      </ul>\n      <emu-note><span class=\"note\">Note</span><div class=\"note-contents\">\n        <p>This requirement means that hosts cannot change the [[Call]] behaviour of function objects defined in this specification.</p>\n      </div></emu-note>\n      <p>The default implementation of HostCallJobCallback performs the following steps when called:</p>\n      <emu-alg><ol><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <emu-xref aoid=\"IsCallable\"><a href=\"#sec-iscallable\">IsCallable</a></emu-xref>(<var>jobCallback</var>.[[Callback]]) is <emu-val>true</emu-val>.</li><li>Return ?&#160;<emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>jobCallback</var>.[[Callback]], <var>V</var>, <var>argumentsList</var>).</li></ol></emu-alg>\n      <p>ECMAScript hosts that are not web browsers must use the default implementation of HostCallJobCallback.</p>\n    </emu-clause>\n\n    "}, "sec-hostmakejobcallback": {"num": "8.4.2", "title": "#sec-hostmakejobcallback HostMakeJobCallback ( callback )", "html": "<emu-clause id=\"sec-hostmakejobcallback\" aoid=\"HostMakeJobCallback\">\n      <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-hostmakejobcallback\">#sec-hostmakejobcallback</span> HostMakeJobCallback ( <var>callback</var> )</h1>\n      <p>HostMakeJobCallback is a <emu-xref href=\"#host-defined\"><a href=\"#host-defined\">host-defined</a></emu-xref> abstract operation that takes argument <var>callback</var> (a <emu-xref href=\"#function-object\"><a href=\"#function-object\">function object</a></emu-xref>).</p>\n      <p>The implementation of HostMakeJobCallback must conform to the following requirements:</p>\n      <ul>\n        <li>It must always complete normally (i.e., not return an <emu-xref href=\"#sec-completion-record-specification-type\"><a href=\"#sec-completion-record-specification-type\">abrupt completion</a></emu-xref>).</li>\n        <li>It must always return a <emu-xref href=\"#sec-jobcallback-records\"><a href=\"#sec-jobcallback-records\">JobCallback Record</a></emu-xref> whose [[Callback]] field is <var>callback</var>.</li>\n      </ul>\n      <p>The default implementation of HostMakeJobCallback performs the following steps when called:</p>\n      <emu-alg><ol><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <emu-xref aoid=\"IsCallable\"><a href=\"#sec-iscallable\">IsCallable</a></emu-xref>(<var>callback</var>) is <emu-val>true</emu-val>.</li><li>Return the <emu-xref href=\"#sec-jobcallback-records\"><a href=\"#sec-jobcallback-records\">JobCallback Record</a></emu-xref> { [[Callback]]: <var>callback</var>, [[HostDefined]]: <emu-const>empty</emu-const> }.</li></ol></emu-alg>\n      <p>ECMAScript hosts that are not web browsers must use the default implementation of HostMakeJobCallback.</p>\n      <emu-note><span class=\"note\">Note</span><div class=\"note-contents\">\n        <p>This is called at the time that the callback is passed to the function that is responsible for its being eventually scheduled and run. For example, <code>promise.then(thenAction)</code> calls MakeJobCallback on <code>thenAction</code> at the time of invoking <code>Promise.prototype.then</code>, not at the time of scheduling the reaction <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref>.</p>\n      </div></emu-note>\n    </emu-clause>\n\n    "}, "sec-triggerpromisereactions": {"num": "26.6.1.8", "title": "#sec-triggerpromisereactions TriggerPromiseReactions ( reactions, argument )", "html": "<emu-clause id=\"sec-triggerpromisereactions\" aoid=\"TriggerPromiseReactions\">\n        <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-triggerpromisereactions\">#sec-triggerpromisereactions</span> TriggerPromiseReactions ( <var>reactions</var>, <var>argument</var> )</h1>\n        <p>The abstract operation TriggerPromiseReactions takes arguments <var>reactions</var> (a collection of PromiseReaction Records) and <var>argument</var>. It enqueues a new <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> for each record in <var>reactions</var>. Each such <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> processes the [[Type]] and [[Handler]] of the PromiseReaction <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">Record</a></emu-xref>, and if the [[Handler]] is not <emu-const>empty</emu-const>, calls it passing the given argument. If the [[Handler]] is <emu-const>empty</emu-const>, the behaviour is determined by the [[Type]]. It performs the following steps when called:</p>\n        <emu-alg><ol><li>For each <var>reaction</var> in <var>reactions</var>, in original insertion order, do<ol><li>Let <var>job</var> be <emu-xref aoid=\"NewPromiseReactionJob\"><a href=\"#sec-newpromisereactionjob\">NewPromiseReactionJob</a></emu-xref>(<var>reaction</var>, <var>argument</var>).</li><li>Perform <emu-xref aoid=\"HostEnqueuePromiseJob\"><a href=\"#sec-hostenqueuepromisejob\">HostEnqueuePromiseJob</a></emu-xref>(<var>job</var>.[[Job]], <var>job</var>.[[Realm]]).</li></ol></li><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>\n      </emu-clause>\n\n      "}, "sec-jobcallback-records": {"num": "8.4.1", "title": "#sec-jobcallback-records JobCallback Records", "html": "<emu-clause id=\"sec-jobcallback-records\">\n      <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-jobcallback-records\">#sec-jobcallback-records</span> JobCallback Records</h1>\n      <p>A <dfn>JobCallback Record</dfn> is a <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">Record</a></emu-xref> value used to store a <emu-xref href=\"#function-object\"><a href=\"#function-object\">function object</a></emu-xref> and a <emu-xref href=\"#host-defined\"><a href=\"#host-defined\">host-defined</a></emu-xref> value. Function objects that are invoked via a <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> enqueued by the <emu-xref href=\"#host\"><a href=\"#host\">host</a></emu-xref> may have additional <emu-xref href=\"#host-defined\"><a href=\"#host-defined\">host-defined</a></emu-xref> context. To propagate the state, <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> Abstract Closures should not capture and call function objects directly. Instead, use <emu-xref aoid=\"HostMakeJobCallback\"><a href=\"#sec-hostmakejobcallback\">HostMakeJobCallback</a></emu-xref> and <emu-xref aoid=\"HostCallJobCallback\"><a href=\"#sec-hostcalljobcallback\">HostCallJobCallback</a></emu-xref>.</p>\n      <emu-note><span class=\"note\">Note</span><div class=\"note-contents\">\n        <p>The WHATWG HTML specification (<a href=\"https://html.spec.whatwg.org/\">https://html.spec.whatwg.org/</a>), for example, uses the <emu-xref href=\"#host-defined\"><a href=\"#host-defined\">host-defined</a></emu-xref> value to propagate the incumbent settings object for Promise callbacks.</p>\n      </div></emu-note>\n      <p>JobCallback Records have the fields listed in <emu-xref href=\"#table-jobcallback-records\"><a href=\"#table-jobcallback-records\" class=\"excluded-xref\" excluded-id=\"table-jobcallback-records\">#table-jobcallback-records</a></emu-xref>.</p>\n      <emu-table id=\"table-jobcallback-records\" caption=\"JobCallback Record Fields\"><figure><figcaption><span class=\"excluded-caption-num\" excluded-id=\"table-jobcallback-records\">#table-jobcallback-records</span>: <emu-xref href=\"#sec-jobcallback-records\"><a href=\"#sec-jobcallback-records\">JobCallback Record</a></emu-xref> Fields</figcaption>\n        <table>\n          <tbody>\n            <tr>\n              <th>\n                Field Name\n              </th>\n              <th>\n                Value\n              </th>\n              <th>\n                Meaning\n              </th>\n            </tr>\n            <tr>\n              <td>\n                [[Callback]]\n              </td>\n              <td>\n                A <emu-xref href=\"#function-object\"><a href=\"#function-object\">function object</a></emu-xref>\n              </td>\n              <td>\n                The function to invoke when the <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> is invoked.\n              </td>\n            </tr>\n            <tr>\n              <td>\n                [[HostDefined]]\n              </td>\n              <td>\n                Any, default value is <emu-const>empty</emu-const>.\n              </td>\n              <td>\n                Field reserved for use by hosts.\n              </td>\n            </tr>\n          </tbody>\n        </table>\n      </figure></emu-table>\n    </emu-clause>\n\n    "}, "sec-jobs": {"num": "8.4", "title": "#sec-jobs Jobs and Host Operations to Enqueue Jobs", "html": "<emu-clause id=\"sec-jobs\" oldids=\"sec-jobs-and-job-queues,sec-enqueuejob,sec-runjobs,job-queue\">\n    <span id=\"job-queue\"></span><span id=\"sec-runjobs\"></span><span id=\"sec-enqueuejob\"></span><span id=\"sec-jobs-and-job-queues\"></span><h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-jobs\">#sec-jobs</span> Jobs and Host Operations to Enqueue Jobs</h1>\n    <p>A <dfn id=\"job\">Job</dfn> is an <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> with no parameters that initiates an ECMAScript computation when no other ECMAScript computation is currently in progress.</p>\n    <p>Jobs are scheduled for execution by ECMAScript <emu-xref href=\"#host\"><a href=\"#host\">host</a></emu-xref> environments. This specification describes the <emu-xref href=\"#host-hook\"><a href=\"#host-hook\">host hook</a></emu-xref> <emu-xref aoid=\"HostEnqueuePromiseJob\"><a href=\"#sec-hostenqueuepromisejob\">HostEnqueuePromiseJob</a></emu-xref> to schedule one kind of job; hosts may define additional <emu-xref href=\"#sec-algorithm-conventions-abstract-operations\"><a href=\"#sec-algorithm-conventions-abstract-operations\">abstract operations</a></emu-xref> which schedule jobs. Such operations accept a <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> as the parameter and schedule it to be performed at some future time. Their implementations must conform to the following requirements:</p>\n\n    <ul>\n      <li>At some future point in time, when there is no <emu-xref href=\"#running-execution-context\"><a href=\"#running-execution-context\">running execution context</a></emu-xref> and the <emu-xref href=\"#execution-context-stack\"><a href=\"#execution-context-stack\">execution context stack</a></emu-xref> is empty, the implementation must:\n        <ol>\n          <li>Perform any <emu-xref href=\"#host-defined\"><a href=\"#host-defined\">host-defined</a></emu-xref> preparation steps.</li>\n          <li><emu-xref aoid=\"Invoke\"><a href=\"#sec-invoke\">Invoke</a></emu-xref> the <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref>.</li>\n          <li>Perform any <emu-xref href=\"#host-defined\"><a href=\"#host-defined\">host-defined</a></emu-xref> cleanup steps, after which the <emu-xref href=\"#execution-context-stack\"><a href=\"#execution-context-stack\">execution context stack</a></emu-xref> must be empty.</li>\n        </ol>\n      </li>\n      <li>Only one <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> may be actively undergoing evaluation at any point in time.</li>\n      <li>Once evaluation of a <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> starts, it must run to completion before evaluation of any other <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> starts.</li>\n      <li>The <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> must return a normal completion, implementing its own handling of errors.</li>\n    </ul>\n\n    <emu-note><span class=\"note\">Note 1</span><div class=\"note-contents\">\n      <emu-xref href=\"#host\"><a href=\"#host\">Host</a></emu-xref> environments are not required to treat Jobs uniformly with respect to scheduling. For example, web browsers and Node.js treat Promise-handling Jobs as a higher priority than other work; future features may add Jobs that are not treated at such a high priority.\n    </div></emu-note>\n\n    <p>At any particular time, <var>scriptOrModule</var> (a <emu-xref href=\"#script-record\"><a href=\"#script-record\">Script Record</a></emu-xref>, a <emu-xref href=\"#sec-abstract-module-records\"><a href=\"#sec-abstract-module-records\">Module Record</a></emu-xref>, or <emu-val>null</emu-val>) is the <dfn id=\"job-activescriptormodule\">active script or module</dfn> if all of the following conditions are true:</p>\n    <ul>\n      <li><emu-xref aoid=\"GetActiveScriptOrModule\"><a href=\"#sec-getactivescriptormodule\">GetActiveScriptOrModule</a></emu-xref>() is <var>scriptOrModule</var>.</li>\n      <li>If <var>scriptOrModule</var> is a <emu-xref href=\"#script-record\"><a href=\"#script-record\">Script Record</a></emu-xref> or <emu-xref href=\"#sec-abstract-module-records\"><a href=\"#sec-abstract-module-records\">Module Record</a></emu-xref>, let <var>ec</var> be the topmost <emu-xref href=\"#sec-execution-contexts\"><a href=\"#sec-execution-contexts\">execution context</a></emu-xref> on the <emu-xref href=\"#execution-context-stack\"><a href=\"#execution-context-stack\">execution context stack</a></emu-xref> whose ScriptOrModule component is <var>scriptOrModule</var>. The <emu-xref href=\"#realm\"><a href=\"#realm\">Realm</a></emu-xref> component of <var>ec</var> is <var>scriptOrModule</var>.[[Realm]].</li>\n    </ul>\n\n    <p>At any particular time, an execution is <dfn id=\"job-preparedtoevaluatecode\">prepared to evaluate ECMAScript code</dfn> if all of the following conditions are true:</p>\n    <ul>\n      <li>The <emu-xref href=\"#execution-context-stack\"><a href=\"#execution-context-stack\">execution context stack</a></emu-xref> is not empty.</li>\n      <li>The <emu-xref href=\"#realm\"><a href=\"#realm\">Realm</a></emu-xref> component of the topmost <emu-xref href=\"#sec-execution-contexts\"><a href=\"#sec-execution-contexts\">execution context</a></emu-xref> on the <emu-xref href=\"#execution-context-stack\"><a href=\"#execution-context-stack\">execution context stack</a></emu-xref> is a <emu-xref href=\"#realm-record\"><a href=\"#realm-record\">Realm Record</a></emu-xref>.</li>\n    </ul>\n\n    <emu-note><span class=\"note\">Note 2</span><div class=\"note-contents\">\n      <p><emu-xref href=\"#host\"><a href=\"#host\">Host</a></emu-xref> environments may prepare an execution to evaluate code by pushing execution contexts onto the <emu-xref href=\"#execution-context-stack\"><a href=\"#execution-context-stack\">execution context stack</a></emu-xref>. The specific steps are <emu-xref href=\"#implementation-defined\"><a href=\"#implementation-defined\">implementation-defined</a></emu-xref>.</p>\n      <p>The specific choice of <emu-xref href=\"#realm\"><a href=\"#realm\">Realm</a></emu-xref> is up to the <emu-xref href=\"#host-environment\"><a href=\"#host-environment\">host environment</a></emu-xref>. This initial <emu-xref href=\"#sec-execution-contexts\"><a href=\"#sec-execution-contexts\">execution context</a></emu-xref> and <emu-xref href=\"#realm\"><a href=\"#realm\">Realm</a></emu-xref> is only in use before any callback function is invoked. When a callback function related to a <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref>, like a Promise handler, is invoked, the invocation pushes its own <emu-xref href=\"#sec-execution-contexts\"><a href=\"#sec-execution-contexts\">execution context</a></emu-xref> and <emu-xref href=\"#realm\"><a href=\"#realm\">Realm</a></emu-xref>.</p>\n    </div></emu-note>\n\n    <p>Particular kinds of Jobs have additional conformance requirements.</p>\n\n    <div id=\"excluded-sec-jobcallback-records\"><h1><span class=\"secnum\">8.4.1</span>#sec-jobcallback-records JobCallback Records</h1>...</div><div id=\"excluded-sec-hostmakejobcallback\"><h1><span class=\"secnum\">8.4.2</span>#sec-hostmakejobcallback HostMakeJobCallback ( callback )</h1>...</div><div id=\"excluded-sec-hostcalljobcallback\"><h1><span class=\"secnum\">8.4.3</span>#sec-hostcalljobcallback HostCallJobCallback ( jobCallback, V, argumentsList )</h1>...</div><div id=\"excluded-sec-hostenqueuepromisejob\"><h1><span class=\"secnum\">8.4.4</span>#sec-hostenqueuepromisejob HostEnqueuePromiseJob ( job, realm )</h1>...</div></emu-clause>\n\n  "}, "sec-script-records": {"num": "15.1.8", "title": "#sec-script-records Script Records", "html": "<emu-clause id=\"sec-script-records\">\n      <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-script-records\">#sec-script-records</span> Script Records</h1>\n\n      <p>A <dfn id=\"script-record\">Script Record</dfn> encapsulates information about a script being evaluated. Each script record contains the fields listed in <emu-xref href=\"#table-script-records\"><a href=\"#table-script-records\" class=\"excluded-xref\" excluded-id=\"table-script-records\">#table-script-records</a></emu-xref>.</p>\n\n      <emu-table id=\"table-script-records\" caption=\"Script Record Fields\"><figure><figcaption><span class=\"excluded-caption-num\" excluded-id=\"table-script-records\">#table-script-records</span>: <emu-xref href=\"#script-record\"><a href=\"#script-record\">Script Record</a></emu-xref> Fields</figcaption>\n        <table>\n          <thead>\n          <tr>\n            <th>\n              Field Name\n            </th>\n            <th>\n              Value Type\n            </th>\n            <th>\n              Meaning\n            </th>\n          </tr>\n          </thead>\n          <tbody>\n          <tr>\n            <td>\n              [[Realm]]\n            </td>\n            <td>\n              <emu-xref href=\"#realm-record\"><a href=\"#realm-record\">Realm Record</a></emu-xref> | <emu-val>undefined</emu-val>\n            </td>\n            <td>\n              The <emu-xref href=\"#realm\"><a href=\"#realm\">realm</a></emu-xref> within which this script was created. <emu-val>undefined</emu-val> if not yet assigned.\n            </td>\n          </tr>\n          <tr>\n            <td>\n              [[Environment]]\n            </td>\n            <td>\n              <emu-xref href=\"#sec-environment-records\"><a href=\"#sec-environment-records\">Environment Record</a></emu-xref> | <emu-val>undefined</emu-val>\n            </td>\n            <td>\n              The <emu-xref href=\"#sec-environment-records\"><a href=\"#sec-environment-records\">Environment Record</a></emu-xref> containing the top level bindings for this script. This field is set when the script is instantiated.\n            </td>\n          </tr>\n          <tr>\n            <td>\n              [[ECMAScriptCode]]\n            </td>\n            <td>\n              a <emu-xref href=\"#sec-syntactic-grammar\"><a href=\"#sec-syntactic-grammar\">Parse Node</a></emu-xref>\n            </td>\n            <td>\n              The result of parsing the source text of this script using <emu-nt><a href=\"#prod-Script\">Script</a></emu-nt> as the <emu-xref href=\"#sec-context-free-grammars\"><a href=\"#sec-context-free-grammars\">goal symbol</a></emu-xref>.\n            </td>\n          </tr>\n          <tr>\n            <td>\n              [[HostDefined]]\n            </td>\n            <td>\n              Any, default value is <emu-const>empty</emu-const>.\n            </td>\n            <td>\n              Field reserved for use by <emu-xref href=\"#host\"><a href=\"#host\">host</a></emu-xref> environments that need to associate additional information with a script.\n            </td>\n          </tr>\n          </tbody>\n        </table>\n      </figure></emu-table>\n    </emu-clause>\n\n    "}, "sec-promise-resolve-functions": {"num": "26.6.1.3.2", "title": "#sec-promise-resolve-functions Promise Resolve Functions", "html": "<emu-clause id=\"sec-promise-resolve-functions\">\n          <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-promise-resolve-functions\">#sec-promise-resolve-functions</span> Promise Resolve Functions</h1>\n          <p>A promise resolve function is an anonymous built-in function that has [[Promise]] and [[AlreadyResolved]] internal slots.</p>\n          <p>When a promise resolve function is called with argument <var>resolution</var>, the following steps are taken:</p>\n          <emu-alg><ol><li>Let <var>F</var> be the <emu-xref href=\"#active-function-object\"><a href=\"#active-function-object\">active function object</a></emu-xref>.</li><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <var>F</var> has a [[Promise]] internal slot whose value is an Object.</li><li>Let <var>promise</var> be <var>F</var>.[[Promise]].</li><li>Let <var>alreadyResolved</var> be <var>F</var>.[[AlreadyResolved]].</li><li>If <var>alreadyResolved</var>.[[Value]] is <emu-val>true</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Set <var>alreadyResolved</var>.[[Value]] to <emu-val>true</emu-val>.</li><li>If <emu-xref aoid=\"SameValue\"><a href=\"#sec-samevalue\">SameValue</a></emu-xref>(<var>resolution</var>, <var>promise</var>) is <emu-val>true</emu-val>, then<ol><li>Let <var>selfResolutionError</var> be a newly created <emu-val>TypeError</emu-val> object.</li><li>Return <emu-xref aoid=\"RejectPromise\"><a href=\"#sec-rejectpromise\">RejectPromise</a></emu-xref>(<var>promise</var>, <var>selfResolutionError</var>).</li></ol></li><li>If <emu-xref aoid=\"Type\"><a href=\"#sec-ecmascript-data-types-and-values\">Type</a></emu-xref>(<var>resolution</var>) is not Object, then<ol><li>Return <emu-xref aoid=\"FulfillPromise\"><a href=\"#sec-fulfillpromise\">FulfillPromise</a></emu-xref>(<var>promise</var>, <var>resolution</var>).</li></ol></li><li>Let <var>then</var> be <emu-xref aoid=\"Get\"><a href=\"#sec-get-o-p\">Get</a></emu-xref>(<var>resolution</var>, <emu-val>\"then\"</emu-val>).</li><li>If <var>then</var> is an <emu-xref href=\"#sec-completion-record-specification-type\"><a href=\"#sec-completion-record-specification-type\">abrupt completion</a></emu-xref>, then<ol><li>Return <emu-xref aoid=\"RejectPromise\"><a href=\"#sec-rejectpromise\">RejectPromise</a></emu-xref>(<var>promise</var>, <var>then</var>.[[Value]]).</li></ol></li><li>Let <var>thenAction</var> be <var>then</var>.[[Value]].</li><li>If <emu-xref aoid=\"IsCallable\"><a href=\"#sec-iscallable\">IsCallable</a></emu-xref>(<var>thenAction</var>) is <emu-val>false</emu-val>, then<ol><li>Return <emu-xref aoid=\"FulfillPromise\"><a href=\"#sec-fulfillpromise\">FulfillPromise</a></emu-xref>(<var>promise</var>, <var>resolution</var>).</li></ol></li><li>Let <var>thenJobCallback</var> be <emu-xref aoid=\"HostMakeJobCallback\"><a href=\"#sec-hostmakejobcallback\">HostMakeJobCallback</a></emu-xref>(<var>thenAction</var>).</li><li>Let <var>job</var> be <emu-xref aoid=\"NewPromiseResolveThenableJob\"><a href=\"#sec-newpromiseresolvethenablejob\">NewPromiseResolveThenableJob</a></emu-xref>(<var>promise</var>, <var>resolution</var>, <var>thenJobCallback</var>).</li><li>Perform <emu-xref aoid=\"HostEnqueuePromiseJob\"><a href=\"#sec-hostenqueuepromisejob\">HostEnqueuePromiseJob</a></emu-xref>(<var>job</var>.[[Job]], <var>job</var>.[[Realm]]).</li><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>\n          <p>The <emu-val>\"length\"</emu-val> property of a promise resolve function is 1.</p>\n        </emu-clause>\n      "}, "sec-performpromisethen": {"num": "26.6.5.4.1", "title": "#sec-performpromisethen PerformPromiseThen ( promise, onFulfilled, onRejected [ , resultCapability ] )", "html": "<emu-clause id=\"sec-performpromisethen\" aoid=\"PerformPromiseThen\">\n          <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-performpromisethen\">#sec-performpromisethen</span> PerformPromiseThen ( <var>promise</var>, <var>onFulfilled</var>, <var>onRejected</var> [ , <var>resultCapability</var> ] )</h1>\n          <p>The abstract operation PerformPromiseThen takes arguments <var>promise</var>, <var>onFulfilled</var>, and <var>onRejected</var> and optional argument <var>resultCapability</var> (a <emu-xref href=\"#sec-promisecapability-records\"><a href=\"#sec-promisecapability-records\">PromiseCapability Record</a></emu-xref>). It performs the &#8220;then&#8221; operation on <var>promise</var> using <var>onFulfilled</var> and <var>onRejected</var> as its settlement actions. If <var>resultCapability</var> is passed, the result is stored by updating <var>resultCapability</var>'s promise. If it is not passed, then PerformPromiseThen is being called by a specification-internal operation where the result does not matter. It performs the following steps when called:</p>\n          <emu-alg><ol><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <emu-xref aoid=\"IsPromise\"><a href=\"#sec-ispromise\">IsPromise</a></emu-xref>(<var>promise</var>) is <emu-val>true</emu-val>.</li><li>If <var>resultCapability</var> is not present, then<ol><li>Set <var>resultCapability</var> to <emu-val>undefined</emu-val>.</li></ol></li><li>If <emu-xref aoid=\"IsCallable\"><a href=\"#sec-iscallable\">IsCallable</a></emu-xref>(<var>onFulfilled</var>) is <emu-val>false</emu-val>, then<ol><li>Let <var>onFulfilledJobCallback</var> be <emu-const>empty</emu-const>.</li></ol></li><li>Else,<ol><li>Let <var>onFulfilledJobCallback</var> be <emu-xref aoid=\"HostMakeJobCallback\"><a href=\"#sec-hostmakejobcallback\">HostMakeJobCallback</a></emu-xref>(<var>onFulfilled</var>).</li></ol></li><li>If <emu-xref aoid=\"IsCallable\"><a href=\"#sec-iscallable\">IsCallable</a></emu-xref>(<var>onRejected</var>) is <emu-val>false</emu-val>, then<ol><li>Let <var>onRejectedJobCallback</var> be <emu-const>empty</emu-const>.</li></ol></li><li>Else,<ol><li>Let <var>onRejectedJobCallback</var> be <emu-xref aoid=\"HostMakeJobCallback\"><a href=\"#sec-hostmakejobcallback\">HostMakeJobCallback</a></emu-xref>(<var>onRejected</var>).</li></ol></li><li>Let <var>fulfillReaction</var> be the PromiseReaction { [[Capability]]: <var>resultCapability</var>, [[Type]]: <emu-const>Fulfill</emu-const>, [[Handler]]: <var>onFulfilledJobCallback</var> }.</li><li>Let <var>rejectReaction</var> be the PromiseReaction { [[Capability]]: <var>resultCapability</var>, [[Type]]: <emu-const>Reject</emu-const>, [[Handler]]: <var>onRejectedJobCallback</var> }.</li><li>If <var>promise</var>.[[PromiseState]] is <emu-const>pending</emu-const>, then<ol><li>Append <var>fulfillReaction</var> as the last element of the <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">List</a></emu-xref> that is <var>promise</var>.[[PromiseFulfillReactions]].</li><li>Append <var>rejectReaction</var> as the last element of the <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">List</a></emu-xref> that is <var>promise</var>.[[PromiseRejectReactions]].</li></ol></li><li>Else if <var>promise</var>.[[PromiseState]] is <emu-const>fulfilled</emu-const>, then<ol><li>Let <var>value</var> be <var>promise</var>.[[PromiseResult]].</li><li>Let <var>fulfillJob</var> be <emu-xref aoid=\"NewPromiseReactionJob\"><a href=\"#sec-newpromisereactionjob\">NewPromiseReactionJob</a></emu-xref>(<var>fulfillReaction</var>, <var>value</var>).</li><li>Perform <emu-xref aoid=\"HostEnqueuePromiseJob\"><a href=\"#sec-hostenqueuepromisejob\">HostEnqueuePromiseJob</a></emu-xref>(<var>fulfillJob</var>.[[Job]], <var>fulfillJob</var>.[[Realm]]).</li></ol></li><li>Else,<ol><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: The value of <var>promise</var>.[[PromiseState]] is <emu-const>rejected</emu-const>.</li><li>Let <var>reason</var> be <var>promise</var>.[[PromiseResult]].</li><li>If <var>promise</var>.[[PromiseIsHandled]] is <emu-val>false</emu-val>, perform <emu-xref aoid=\"HostPromiseRejectionTracker\"><a href=\"#sec-host-promise-rejection-tracker\">HostPromiseRejectionTracker</a></emu-xref>(<var>promise</var>, <emu-val>\"handle\"</emu-val>).</li><li>Let <var>rejectJob</var> be <emu-xref aoid=\"NewPromiseReactionJob\"><a href=\"#sec-newpromisereactionjob\">NewPromiseReactionJob</a></emu-xref>(<var>rejectReaction</var>, <var>reason</var>).</li><li>Perform <emu-xref aoid=\"HostEnqueuePromiseJob\"><a href=\"#sec-hostenqueuepromisejob\">HostEnqueuePromiseJob</a></emu-xref>(<var>rejectJob</var>.[[Job]], <var>rejectJob</var>.[[Realm]]).</li></ol></li><li>Set <var>promise</var>.[[PromiseIsHandled]] to <emu-val>true</emu-val>.</li><li>If <var>resultCapability</var> is <emu-val>undefined</emu-val>, then<ol><li>Return <emu-val>undefined</emu-val>.</li></ol></li><li>Else,<ol><li>Return <var>resultCapability</var>.[[Promise]].</li></ol></li></ol></emu-alg>\n        </emu-clause>\n      "}, "sec-newpromisereactionjob": {"num": "26.6.2.1", "title": "#sec-newpromisereactionjob NewPromiseReactionJob ( reaction, argument )", "html": "<emu-clause id=\"sec-newpromisereactionjob\" aoid=\"NewPromiseReactionJob\" oldids=\"sec-promisereactionjob\">\n        <span id=\"sec-promisereactionjob\"></span><h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-newpromisereactionjob\">#sec-newpromisereactionjob</span> NewPromiseReactionJob ( <var>reaction</var>, <var>argument</var> )</h1>\n        <p>The abstract operation NewPromiseReactionJob takes arguments <var>reaction</var> and <var>argument</var>. It returns a new <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> that applies the appropriate handler to the incoming value, and uses the handler's return value to resolve or reject the derived promise associated with that handler. It performs the following steps when called:</p>\n        <emu-alg><ol><li>Let <var>job</var> be a new <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> with no parameters that captures <var>reaction</var> and <var>argument</var> and performs the following steps when called:<ol><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <var>reaction</var> is a PromiseReaction <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">Record</a></emu-xref>.</li><li>Let <var>promiseCapability</var> be <var>reaction</var>.[[Capability]].</li><li>Let <var>type</var> be <var>reaction</var>.[[Type]].</li><li>Let <var>handler</var> be <var>reaction</var>.[[Handler]].</li><li>If <var>handler</var> is <emu-const>empty</emu-const>, then<ol><li>If <var>type</var> is <emu-const>Fulfill</emu-const>, let <var>handlerResult</var> be <emu-xref aoid=\"NormalCompletion\"><a href=\"#sec-normalcompletion\">NormalCompletion</a></emu-xref>(<var>argument</var>).</li><li>Else,<ol><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <var>type</var> is <emu-const>Reject</emu-const>.</li><li>Let <var>handlerResult</var> be <emu-xref aoid=\"ThrowCompletion\"><a href=\"#sec-throwcompletion\">ThrowCompletion</a></emu-xref>(<var>argument</var>).</li></ol></li></ol></li><li>Else, let <var>handlerResult</var> be <emu-xref aoid=\"HostCallJobCallback\"><a href=\"#sec-hostcalljobcallback\">HostCallJobCallback</a></emu-xref>(<var>handler</var>, <emu-val>undefined</emu-val>, &#171; <var>argument</var> &#187;).</li><li>If <var>promiseCapability</var> is <emu-val>undefined</emu-val>, then<ol><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <var>handlerResult</var> is not an <emu-xref href=\"#sec-completion-record-specification-type\"><a href=\"#sec-completion-record-specification-type\">abrupt completion</a></emu-xref>.</li><li>Return <emu-xref aoid=\"NormalCompletion\"><a href=\"#sec-normalcompletion\">NormalCompletion</a></emu-xref>(<emu-const>empty</emu-const>).</li></ol></li><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <var>promiseCapability</var> is a <emu-xref href=\"#sec-promisecapability-records\"><a href=\"#sec-promisecapability-records\">PromiseCapability Record</a></emu-xref>.</li><li>If <var>handlerResult</var> is an <emu-xref href=\"#sec-completion-record-specification-type\"><a href=\"#sec-completion-record-specification-type\">abrupt completion</a></emu-xref>, then<ol><li>Let <var>status</var> be <emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>promiseCapability</var>.[[Reject]], <emu-val>undefined</emu-val>, &#171; <var>handlerResult</var>.[[Value]] &#187;).</li></ol></li><li>Else,<ol><li>Let <var>status</var> be <emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>promiseCapability</var>.[[Resolve]], <emu-val>undefined</emu-val>, &#171; <var>handlerResult</var>.[[Value]] &#187;).</li></ol></li><li>Return <emu-xref aoid=\"Completion\"><a href=\"#sec-completion-record-specification-type\">Completion</a></emu-xref>(<var>status</var>).</li></ol></li><li>Let <var>handlerRealm</var> be <emu-val>null</emu-val>.</li><li>If <var>reaction</var>.[[Handler]] is not <emu-const>empty</emu-const>, then<ol><li>Let <var>getHandlerRealmResult</var> be <emu-xref aoid=\"GetFunctionRealm\"><a href=\"#sec-getfunctionrealm\">GetFunctionRealm</a></emu-xref>(<var>reaction</var>.[[Handler]].[[Callback]]).</li><li>If <var>getHandlerRealmResult</var> is a normal completion, then set <var>handlerRealm</var> to <var>getHandlerRealmResult</var>.[[Value]].</li><li>Else, set <var>handlerRealm</var> to <emu-xref href=\"#current-realm\"><a href=\"#current-realm\">the current Realm Record</a></emu-xref>.</li><li>NOTE: <var>handlerRealm</var> is never <emu-val>null</emu-val> unless the handler is <emu-val>undefined</emu-val>. When the handler is a revoked Proxy and no ECMAScript code runs, <var>handlerRealm</var> is used to create error objects.</li></ol></li><li>Return the <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">Record</a></emu-xref> { [[Job]]: <var>job</var>, [[Realm]]: <var>handlerRealm</var> }.</li></ol></emu-alg>\n      </emu-clause>\n\n      "}, "sec-promisereaction-records": {"num": "26.6.1.2", "title": "#sec-promisereaction-records PromiseReaction Records", "html": "<emu-clause id=\"sec-promisereaction-records\">\n        <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-promisereaction-records\">#sec-promisereaction-records</span> PromiseReaction Records</h1>\n        <p>The PromiseReaction is a <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">Record</a></emu-xref> value used to store information about how a promise should react when it becomes resolved or rejected with a given value. PromiseReaction records are created by the <emu-xref aoid=\"PerformPromiseThen\"><a href=\"#sec-performpromisethen\">PerformPromiseThen</a></emu-xref> abstract operation, and are used by the <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> returned by <emu-xref aoid=\"NewPromiseReactionJob\"><a href=\"#sec-newpromisereactionjob\">NewPromiseReactionJob</a></emu-xref>.</p>\n        <p>PromiseReaction records have the fields listed in <emu-xref href=\"#table-58\"><a href=\"#table-58\" class=\"excluded-xref\" excluded-id=\"table-58\">#table-58</a></emu-xref>.</p>\n        <emu-table id=\"table-58\" caption=\"PromiseReaction Record Fields\"><figure><figcaption><span class=\"excluded-caption-num\" excluded-id=\"table-58\">#table-58</span>: PromiseReaction <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">Record</a></emu-xref> Fields</figcaption>\n          <table>\n            <tbody>\n            <tr>\n              <th>\n                Field Name\n              </th>\n              <th>\n                Value\n              </th>\n              <th>\n                Meaning\n              </th>\n            </tr>\n            <tr>\n              <td>\n                [[Capability]]\n              </td>\n              <td>\n                A <emu-xref href=\"#sec-promisecapability-records\"><a href=\"#sec-promisecapability-records\">PromiseCapability Record</a></emu-xref>, or <emu-val>undefined</emu-val>\n              </td>\n              <td>\n                The capabilities of the promise for which this record provides a reaction handler.\n              </td>\n            </tr>\n            <tr>\n              <td>\n                [[Type]]\n              </td>\n              <td>\n                <emu-const>Fulfill</emu-const> | <emu-const>Reject</emu-const>\n              </td>\n              <td>\n                The [[Type]] is used when [[Handler]] is <emu-const>empty</emu-const> to allow for behaviour specific to the settlement type.\n              </td>\n            </tr>\n            <tr>\n              <td>\n                [[Handler]]\n              </td>\n              <td>\n                A <emu-xref href=\"#sec-jobcallback-records\"><a href=\"#sec-jobcallback-records\">JobCallback Record</a></emu-xref> | <emu-const>empty</emu-const>.\n              </td>\n              <td>\n                The function that should be applied to the incoming value, and whose return value will govern what happens to the derived promise. If [[Handler]] is <emu-const>empty</emu-const>, a function that depends on the value of [[Type]] will be used instead.\n              </td>\n            </tr>\n            </tbody>\n          </table>\n        </figure></emu-table>\n      </emu-clause>\n\n      "}, "sec-newpromiseresolvethenablejob": {"num": "26.6.2.2", "title": "#sec-newpromiseresolvethenablejob NewPromiseResolveThenableJob ( promiseToResolve, thenable, then )", "html": "<emu-clause id=\"sec-newpromiseresolvethenablejob\" aoid=\"NewPromiseResolveThenableJob\" oldids=\"sec-promiseresolvethenablejob\">\n        <span id=\"sec-promiseresolvethenablejob\"></span><h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-newpromiseresolvethenablejob\">#sec-newpromiseresolvethenablejob</span> NewPromiseResolveThenableJob ( <var>promiseToResolve</var>, <var>thenable</var>, <var>then</var> )</h1>\n        <p>The abstract operation NewPromiseResolveThenableJob takes arguments <var>promiseToResolve</var>, <var>thenable</var>, and <var>then</var>. It performs the following steps when called:</p>\n        <emu-alg><ol><li>Let <var>job</var> be a new <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> with no parameters that captures <var>promiseToResolve</var>, <var>thenable</var>, and <var>then</var> and performs the following steps when called:<ol><li>Let <var>resolvingFunctions</var> be <emu-xref aoid=\"CreateResolvingFunctions\"><a href=\"#sec-createresolvingfunctions\">CreateResolvingFunctions</a></emu-xref>(<var>promiseToResolve</var>).</li><li>Let <var>thenCallResult</var> be <emu-xref aoid=\"HostCallJobCallback\"><a href=\"#sec-hostcalljobcallback\">HostCallJobCallback</a></emu-xref>(<var>then</var>, <var>thenable</var>, &#171; <var>resolvingFunctions</var>.[[Resolve]], <var>resolvingFunctions</var>.[[Reject]] &#187;).</li><li>If <var>thenCallResult</var> is an <emu-xref href=\"#sec-completion-record-specification-type\"><a href=\"#sec-completion-record-specification-type\">abrupt completion</a></emu-xref>, then<ol><li>Let <var>status</var> be <emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>resolvingFunctions</var>.[[Reject]], <emu-val>undefined</emu-val>, &#171; <var>thenCallResult</var>.[[Value]] &#187;).</li><li>Return <emu-xref aoid=\"Completion\"><a href=\"#sec-completion-record-specification-type\">Completion</a></emu-xref>(<var>status</var>).</li></ol></li><li>Return <emu-xref aoid=\"Completion\"><a href=\"#sec-completion-record-specification-type\">Completion</a></emu-xref>(<var>thenCallResult</var>).</li></ol></li><li>Let <var>getThenRealmResult</var> be <emu-xref aoid=\"GetFunctionRealm\"><a href=\"#sec-getfunctionrealm\">GetFunctionRealm</a></emu-xref>(<var>then</var>.[[Callback]]).</li><li>If <var>getThenRealmResult</var> is a normal completion, then let <var>thenRealm</var> be <var>getThenRealmResult</var>.[[Value]].</li><li>Else, let <var>thenRealm</var> be <emu-xref href=\"#current-realm\"><a href=\"#current-realm\">the current Realm Record</a></emu-xref>.</li><li>NOTE: <var>thenRealm</var> is never <emu-val>null</emu-val>. When <var>then</var>.[[Callback]] is a revoked Proxy and no code runs, <var>thenRealm</var> is used to create error objects.</li><li>Return the <emu-xref href=\"#sec-list-and-record-specification-type\"><a href=\"#sec-list-and-record-specification-type\">Record</a></emu-xref> { [[Job]]: <var>job</var>, [[Realm]]: <var>thenRealm</var> }.</li></ol></emu-alg>\n        <emu-note><span class=\"note\">Note</span><div class=\"note-contents\">\n          <p>This <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> uses the supplied thenable and its <code>then</code> method to resolve the given promise. This process must take place as a <emu-xref href=\"#job\"><a href=\"#job\">Job</a></emu-xref> to ensure that the evaluation of the <code>then</code> method occurs after evaluation of any surrounding code has completed.</p>\n        </div></emu-note>\n      </emu-clause>\n    "}}, "figData": {"table-2": "Table 3", "table-3": "Table 4", "table-5": "Table 6", "table-21": "Table 22", "table-jobcallback-records": "Table 26", "table-script-records": "Table 38", "table-36": "Table 39", "table-58": "Table 78", "table-candidate-execution-records": "Table 85"}}}