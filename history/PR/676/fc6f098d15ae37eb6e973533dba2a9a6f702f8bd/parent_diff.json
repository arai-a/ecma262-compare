{"from": {"secList": ["sec-block-level-function-declarations-web-legacy-compatibility-semantics"], "secData": {"sec-block-level-function-declarations-web-legacy-compatibility-semantics": {"num": "B.3.3", "title": "#sec-block-level-function-declarations-web-legacy-compatibility-semantics Block-Level Function Declarations Web Legacy Compatibility Semantics", "html": "<emu-annex id=\"sec-block-level-function-declarations-web-legacy-compatibility-semantics\">\n      <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-block-level-function-declarations-web-legacy-compatibility-semantics\">#sec-block-level-function-declarations-web-legacy-compatibility-semantics</span> Block-Level Function Declarations Web Legacy Compatibility Semantics</h1>\n      <p>Prior to ECMAScript 2015, the ECMAScript specification did not define the occurrence of a <emu-nt><a href=\"#prod-FunctionDeclaration\">FunctionDeclaration</a></emu-nt> as an element of a <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> statement's <emu-nt><a href=\"#prod-StatementList\">StatementList</a></emu-nt>. However, support for that form of <emu-nt><a href=\"#prod-FunctionDeclaration\">FunctionDeclaration</a></emu-nt> was an allowable extension and most browser-hosted ECMAScript implementations permitted them. Unfortunately, the semantics of such declarations differ among those implementations. Because of these semantic differences, existing web ECMAScript code that uses <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> level function declarations is only portable among browser implementation if the usage only depends upon the semantic intersection of all of the browser implementations for such declarations. The following are the use cases that fall within that intersection semantics:</p>\n      <ol>\n        <li>\n          <p>A function is declared and only referenced within a single block</p>\n          <ul>\n            <li>\n              One or more <emu-nt><a href=\"#prod-FunctionDeclaration\">FunctionDeclaration</a></emu-nt>s whose <emu-nt><a href=\"#prod-annexB-BindingIdentifier\">BindingIdentifier</a></emu-nt> is the name <var>f</var> occur within the function code of an enclosing function <var>g</var> and that declaration is nested within a <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt>.\n            \n            </li>\n            <li>\n              No other declaration of <var>f</var> that is not a <code>var</code> declaration occurs within the function code of <var>g</var>\n            \n            </li>\n            <li>\n              All occurrences of <var>f</var> as an <emu-nt><a href=\"#prod-IdentifierReference\">IdentifierReference</a></emu-nt> are within the <emu-nt><a href=\"#prod-StatementList\">StatementList</a></emu-nt> of the <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> containing the declaration of <var>f</var>.\n            \n            </li>\n          </ul>\n        </li>\n        <li>\n          <p>A function is declared and possibly used within a single <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> but also referenced by an inner function definition that is not contained within that same <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt>.</p>\n          <ul>\n            <li>\n              One or more <emu-nt><a href=\"#prod-FunctionDeclaration\">FunctionDeclaration</a></emu-nt>s whose <emu-nt><a href=\"#prod-annexB-BindingIdentifier\">BindingIdentifier</a></emu-nt> is the name <var>f</var> occur within the function code of an enclosing function <var>g</var> and that declaration is nested within a <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt>.\n            \n            </li>\n            <li>\n              No other declaration of <var>f</var> that is not a <code>var</code> declaration occurs within the function code of <var>g</var>\n            \n            </li>\n            <li>\n              There may be occurrences of <var>f</var> as an <emu-nt><a href=\"#prod-IdentifierReference\">IdentifierReference</a></emu-nt> within the <emu-nt><a href=\"#prod-StatementList\">StatementList</a></emu-nt> of the <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> containing the declaration of <var>f</var>.\n            \n            </li>\n            <li>\n              There is at least one occurrence of <var>f</var> as an <emu-nt><a href=\"#prod-IdentifierReference\">IdentifierReference</a></emu-nt> within another function <var>h</var> that is nested within <var>g</var> and no other declaration of <var>f</var> shadows the references to <var>f</var> from within <var>h</var>.\n            \n            </li>\n            <li>\n              All invocations of <var>h</var> occur after the declaration of <var>f</var> has been evaluated.\n            \n            </li>\n          </ul>\n        </li>\n        <li>\n          <p>A function is declared and possibly used within a single block but also referenced within subsequent blocks.</p>\n          <ul>\n            <li>\n              One or more <emu-nt><a href=\"#prod-FunctionDeclaration\">FunctionDeclaration</a></emu-nt> whose <emu-nt><a href=\"#prod-annexB-BindingIdentifier\">BindingIdentifier</a></emu-nt> is the name <var>f</var> occur within the function code of an enclosing function <var>g</var> and that declaration is nested within a <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt>.\n            \n            </li>\n            <li>\n              No other declaration of <var>f</var> that is not a <code>var</code> declaration occurs within the function code of <var>g</var>\n            \n            </li>\n            <li>\n              There may be occurrences of <var>f</var> as an <emu-nt><a href=\"#prod-IdentifierReference\">IdentifierReference</a></emu-nt> within the <emu-nt><a href=\"#prod-StatementList\">StatementList</a></emu-nt> of the <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> containing the declaration of <var>f</var>.\n            \n            </li>\n            <li>\n              There is at least one occurrence of <var>f</var> as an <emu-nt><a href=\"#prod-IdentifierReference\">IdentifierReference</a></emu-nt> within the function code of <var>g</var> that lexically follows the <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> containing the declaration of <var>f</var>.\n            \n            </li>\n          </ul>\n        </li>\n      </ol>\n      <p>The first use case is interoperable with the semantics of <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> level function declarations provided by ECMAScript 2015. Any pre-existing ECMAScript code that employs that use case will operate using the Block level function declarations semantics defined by clauses 9, 13, and 14 of this specification.</p>\n      <p>ECMAScript 2015 interoperability for the second and third use cases requires the following extensions to the clause  <emu-xref href=\"#sec-ordinary-and-exotic-objects-behaviours\"><a href=\"#sec-ordinary-and-exotic-objects-behaviours\" class=\"excluded-xref\" excluded-id=\"sec-ordinary-and-exotic-objects-behaviours\">#sec-ordinary-and-exotic-objects-behaviours</a></emu-xref>, clause  <emu-xref href=\"#sec-ecmascript-language-functions-and-classes\"><a href=\"#sec-ecmascript-language-functions-and-classes\" class=\"excluded-xref\" excluded-id=\"sec-ecmascript-language-functions-and-classes\">#sec-ecmascript-language-functions-and-classes</a></emu-xref>, clause  <emu-xref href=\"#sec-eval-x\"><a href=\"#sec-eval-x\" class=\"excluded-xref\" excluded-id=\"sec-eval-x\">#sec-eval-x</a></emu-xref> and clause  <emu-xref href=\"#sec-globaldeclarationinstantiation\"><a href=\"#sec-globaldeclarationinstantiation\" class=\"excluded-xref\" excluded-id=\"sec-globaldeclarationinstantiation\">#sec-globaldeclarationinstantiation</a></emu-xref> semantics.</p>\n      <p>If an ECMAScript implementation has a mechanism for reporting diagnostic warning messages, a warning should be produced when code contains a <emu-nt><a href=\"#prod-FunctionDeclaration\">FunctionDeclaration</a></emu-nt> for which these compatibility semantics are applied and introduce observable differences from non-compatibility semantics. For example, if a var binding is not introduced because its introduction would create an <emu-xref href=\"#early-error\"><a href=\"#early-error\">early error</a></emu-xref>, a warning message should not be produced.</p>\n      <div id=\"excluded-sec-web-compat-functiondeclarationinstantiation\"><h1><span class=\"secnum\">B.3.3.1</span>#sec-web-compat-functiondeclarationinstantiation Changes to FunctionDeclarationInstantiation</h1>...</div><div id=\"excluded-sec-web-compat-globaldeclarationinstantiation\"><h1><span class=\"secnum\">B.3.3.2</span>#sec-web-compat-globaldeclarationinstantiation Changes to GlobalDeclarationInstantiation</h1>...</div><div id=\"excluded-sec-web-compat-evaldeclarationinstantiation\"><h1><span class=\"secnum\">B.3.3.3</span>#sec-web-compat-evaldeclarationinstantiation Changes to EvalDeclarationInstantiation</h1>...</div><div id=\"excluded-sec-block-duplicates-allowed-static-semantics\"><h1><span class=\"secnum\">B.3.3.4</span>#sec-block-duplicates-allowed-static-semantics Changes to Block Static Semantics: Early Errors</h1>...</div><div id=\"excluded-sec-web-compat-blockdeclarationinstantiation\"><h1><span class=\"secnum\">B.3.3.5</span>#sec-web-compat-blockdeclarationinstantiation Changes to BlockDeclarationInstantiation</h1>...</div></emu-annex>\n\n    "}}, "figData": {}}, "to": {"secList": ["sec-block-level-function-declarations-web-legacy-compatibility-semantics"], "secData": {"sec-block-level-function-declarations-web-legacy-compatibility-semantics": {"num": "B.3.3", "title": "#sec-block-level-function-declarations-web-legacy-compatibility-semantics Block-Level Function Declarations Web Legacy Compatibility Semantics", "html": "<emu-annex id=\"sec-block-level-function-declarations-web-legacy-compatibility-semantics\">\n      <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-block-level-function-declarations-web-legacy-compatibility-semantics\">#sec-block-level-function-declarations-web-legacy-compatibility-semantics</span> Block-Level Function Declarations Web Legacy Compatibility Semantics</h1>\n      <p>Prior to ECMAScript 2015, the ECMAScript specification did not define the occurrence of a <emu-nt><a href=\"#prod-FunctionDeclaration\">FunctionDeclaration</a></emu-nt> as an element of a <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> statement's <emu-nt><a href=\"#prod-StatementList\">StatementList</a></emu-nt>. However, support for that form of <emu-nt><a href=\"#prod-FunctionDeclaration\">FunctionDeclaration</a></emu-nt> was an allowable extension and most browser-hosted ECMAScript implementations permitted them. Unfortunately, the semantics of such declarations differ among those implementations. Because of these semantic differences, existing web ECMAScript code that uses <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> level function declarations is only portable among browser implementation if the usage only depends upon the semantic intersection of all of the browser implementations for such declarations.</p>\n      <p>These are the threshold requirements for the semantic intersection to potentially occur:</p>\n      <ul>\n        <li>One or more <emu-nt><a href=\"#prod-FunctionDeclaration\">FunctionDeclaration</a></emu-nt>s whose <emu-nt><a href=\"#prod-annexB-BindingIdentifier\">BindingIdentifier</a></emu-nt> is the name <var>f</var> occur within the function code of an enclosing function <var>g</var>.</li>\n        <li>Those <emu-nt><a href=\"#prod-FunctionDeclaration\">FunctionDeclaration</a></emu-nt>s are nested within a single <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt>.</li>\n        <li>No other declaration of <var>f</var> that is not a <code>var</code> declaration occurs within the function code of <var>g</var>.</li>\n      </ul>\n      <p>If those requirements are satisfied, the following use cases fall within the semantic intersection among browser implementations:</p>\n      <ol>\n        <li>\n          <p>A function is declared and only referenced within a single block</p>\n          <ul>\n            <li>\n              All occurrences of <var>f</var> as an <emu-nt><a href=\"#prod-IdentifierReference\">IdentifierReference</a></emu-nt> are within the <emu-nt><a href=\"#prod-StatementList\">StatementList</a></emu-nt> of the <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> containing the declaration of <var>f</var>.\n            \n            </li>\n          </ul>\n        </li>\n        <li>\n          <p>A function is declared and possibly used within a single <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> but also referenced by an inner function definition that is not contained within that same <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt>.</p>\n          <ul>\n            <li>\n              There may be occurrences of <var>f</var> as an <emu-nt><a href=\"#prod-IdentifierReference\">IdentifierReference</a></emu-nt> within the <emu-nt><a href=\"#prod-StatementList\">StatementList</a></emu-nt> of the <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> containing the declaration of <var>f</var>.\n            \n            </li>\n            <li>\n              There is at least one occurrence of <var>f</var> as an <emu-nt><a href=\"#prod-IdentifierReference\">IdentifierReference</a></emu-nt> within another function <var>h</var> that is nested within <var>g</var> and no other declaration of <var>f</var> shadows the references to <var>f</var> from within <var>h</var>.\n            \n            </li>\n            <li>\n              All invocations of <var>h</var> occur after the declaration of <var>f</var> has been evaluated.\n            \n            </li>\n          </ul>\n        </li>\n        <li>\n          <p>A function is declared and possibly used within a single block but also referenced within subsequent blocks.</p>\n          <ul>\n            <li>\n              There may be occurrences of <var>f</var> as an <emu-nt><a href=\"#prod-IdentifierReference\">IdentifierReference</a></emu-nt> within the <emu-nt><a href=\"#prod-StatementList\">StatementList</a></emu-nt> of the <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> containing the declaration of <var>f</var>.\n            \n            </li>\n            <li>\n              There is at least one occurrence of <var>f</var> as an <emu-nt><a href=\"#prod-IdentifierReference\">IdentifierReference</a></emu-nt> within the function code of <var>g</var> that lexically follows the <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> containing the declaration of <var>f</var>.\n            \n            </li>\n          </ul>\n        </li>\n      </ol>\n      <p>The first use case is interoperable with the semantics of <emu-nt><a href=\"#prod-annexB-Block\">Block</a></emu-nt> level function declarations provided by ECMAScript 2015. Any pre-existing ECMAScript code that employs that use case will operate using the Block level function declarations semantics defined by clauses 9, 13, and 14 of this specification.</p>\n      <p>ECMAScript 2015 interoperability for the second and third use cases requires the following extensions to the clause  <emu-xref href=\"#sec-ordinary-and-exotic-objects-behaviours\"><a href=\"#sec-ordinary-and-exotic-objects-behaviours\" class=\"excluded-xref\" excluded-id=\"sec-ordinary-and-exotic-objects-behaviours\">#sec-ordinary-and-exotic-objects-behaviours</a></emu-xref>, clause  <emu-xref href=\"#sec-ecmascript-language-functions-and-classes\"><a href=\"#sec-ecmascript-language-functions-and-classes\" class=\"excluded-xref\" excluded-id=\"sec-ecmascript-language-functions-and-classes\">#sec-ecmascript-language-functions-and-classes</a></emu-xref>, clause  <emu-xref href=\"#sec-eval-x\"><a href=\"#sec-eval-x\" class=\"excluded-xref\" excluded-id=\"sec-eval-x\">#sec-eval-x</a></emu-xref> and clause  <emu-xref href=\"#sec-globaldeclarationinstantiation\"><a href=\"#sec-globaldeclarationinstantiation\" class=\"excluded-xref\" excluded-id=\"sec-globaldeclarationinstantiation\">#sec-globaldeclarationinstantiation</a></emu-xref> semantics.</p>\n      <p>If an ECMAScript implementation has a mechanism for reporting diagnostic warning messages, a warning should be produced when code contains a <emu-nt><a href=\"#prod-FunctionDeclaration\">FunctionDeclaration</a></emu-nt> for which these compatibility semantics are applied and introduce observable differences from non-compatibility semantics. For example, if a var binding is not introduced because its introduction would create an <emu-xref href=\"#early-error\"><a href=\"#early-error\">early error</a></emu-xref>, a warning message should not be produced.</p>\n      <div id=\"excluded-sec-web-compat-functiondeclarationinstantiation\"><h1><span class=\"secnum\">B.3.3.1</span>#sec-web-compat-functiondeclarationinstantiation Changes to FunctionDeclarationInstantiation</h1>...</div><div id=\"excluded-sec-web-compat-globaldeclarationinstantiation\"><h1><span class=\"secnum\">B.3.3.2</span>#sec-web-compat-globaldeclarationinstantiation Changes to GlobalDeclarationInstantiation</h1>...</div><div id=\"excluded-sec-web-compat-evaldeclarationinstantiation\"><h1><span class=\"secnum\">B.3.3.3</span>#sec-web-compat-evaldeclarationinstantiation Changes to EvalDeclarationInstantiation</h1>...</div><div id=\"excluded-sec-block-duplicates-allowed-static-semantics\"><h1><span class=\"secnum\">B.3.3.4</span>#sec-block-duplicates-allowed-static-semantics Changes to Block Static Semantics: Early Errors</h1>...</div><div id=\"excluded-sec-web-compat-blockdeclarationinstantiation\"><h1><span class=\"secnum\">B.3.3.5</span>#sec-web-compat-blockdeclarationinstantiation Changes to BlockDeclarationInstantiation</h1>...</div></emu-annex>\n\n    "}}, "figData": {}}}