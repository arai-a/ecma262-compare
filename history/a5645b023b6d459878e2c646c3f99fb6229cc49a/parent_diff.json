{"from": {"secList": ["sec-promise.prototype.finally", "sec-catchfinallyfunctions", "sec-thenfinallyfunctions"], "secData": {"sec-promise.prototype.finally": {"num": "27.2.5.3", "title": "#sec-promise.prototype.finally Promise.prototype.finally ( onFinally )", "html": "<emu-clause id=\"sec-promise.prototype.finally\">\n        <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-promise.prototype.finally\">#sec-promise.prototype.finally</span> Promise.prototype.finally ( <var>onFinally</var> )</h1>\n        <p>When the <code>finally</code> method is called with argument <var>onFinally</var>, the following steps are taken:</p>\n        <emu-alg><ol><li>Let <var>promise</var> be the <emu-val>this</emu-val> value.</li><li>If <emu-xref aoid=\"Type\"><a href=\"#sec-ecmascript-data-types-and-values\">Type</a></emu-xref>(<var>promise</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>C</var> be ?&#160;<emu-xref aoid=\"SpeciesConstructor\"><a href=\"#sec-speciesconstructor\">SpeciesConstructor</a></emu-xref>(<var>promise</var>, <emu-xref href=\"#sec-promise-constructor\"><a href=\"#sec-promise-constructor\">%Promise%</a></emu-xref>).</li><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <emu-xref aoid=\"IsConstructor\"><a href=\"#sec-isconstructor\">IsConstructor</a></emu-xref>(<var>C</var>) is <emu-val>true</emu-val>.</li><li>If <emu-xref aoid=\"IsCallable\"><a href=\"#sec-iscallable\">IsCallable</a></emu-xref>(<var>onFinally</var>) is <emu-val>false</emu-val>, then<ol><li>Let <var>thenFinally</var> be <var>onFinally</var>.</li><li>Let <var>catchFinally</var> be <var>onFinally</var>.</li></ol></li><li>Else,<ol><li>Let <var>stepsThenFinally</var> be the algorithm steps defined in <emu-xref href=\"#sec-thenfinallyfunctions\" title=\"\"><a href=\"#sec-thenfinallyfunctions\">Then Finally Functions</a></emu-xref>.</li><li>Let <var>lengthThenFinally</var> be the number of non-optional parameters of the function definition in <emu-xref href=\"#sec-thenfinallyfunctions\" title=\"\"><a href=\"#sec-thenfinallyfunctions\">Then Finally Functions</a></emu-xref>.</li><li>Let <var>thenFinally</var> be !&#160;<emu-xref aoid=\"CreateBuiltinFunction\"><a href=\"#sec-createbuiltinfunction\">CreateBuiltinFunction</a></emu-xref>(<var>stepsThenFinally</var>, <var>lengthThenFinally</var>, <emu-val>\"\"</emu-val>, &#171; [[Constructor]], [[OnFinally]] &#187;).</li><li>Set <var>thenFinally</var>.[[Constructor]] to <var>C</var>.</li><li>Set <var>thenFinally</var>.[[OnFinally]] to <var>onFinally</var>.</li><li>Let <var>stepsCatchFinally</var> be the algorithm steps defined in <emu-xref href=\"#sec-catchfinallyfunctions\" title=\"\"><a href=\"#sec-catchfinallyfunctions\">Catch Finally Functions</a></emu-xref>.</li><li>Let <var>lengthCatchFinally</var> be the number of non-optional parameters of the function definition in <emu-xref href=\"#sec-catchfinallyfunctions\" title=\"\"><a href=\"#sec-catchfinallyfunctions\">Catch Finally Functions</a></emu-xref>.</li><li>Let <var>catchFinally</var> be !&#160;<emu-xref aoid=\"CreateBuiltinFunction\"><a href=\"#sec-createbuiltinfunction\">CreateBuiltinFunction</a></emu-xref>(<var>stepsCatchFinally</var>, <var>lengthCatchFinally</var>, <emu-val>\"\"</emu-val>, &#171; [[Constructor]], [[OnFinally]] &#187;).</li><li>Set <var>catchFinally</var>.[[Constructor]] to <var>C</var>.</li><li>Set <var>catchFinally</var>.[[OnFinally]] to <var>onFinally</var>.</li></ol></li><li>Return ?&#160;<emu-xref aoid=\"Invoke\"><a href=\"#sec-invoke\">Invoke</a></emu-xref>(<var>promise</var>, <emu-val>\"then\"</emu-val>, &#171; <var>thenFinally</var>, <var>catchFinally</var> &#187;).</li></ol></emu-alg>\n\n        <div id=\"excluded-sec-thenfinallyfunctions\"><h1><span class=\"secnum\">27.2.5.3.1</span>#sec-thenfinallyfunctions Then Finally Functions</h1>...</div><div id=\"excluded-sec-catchfinallyfunctions\"><h1><span class=\"secnum\">27.2.5.3.2</span>#sec-catchfinallyfunctions Catch Finally Functions</h1>...</div></emu-clause>\n\n      "}, "sec-catchfinallyfunctions": {"num": "27.2.5.3.2", "title": "#sec-catchfinallyfunctions Catch Finally Functions", "html": "<emu-clause id=\"sec-catchfinallyfunctions\">\n          <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-catchfinallyfunctions\">#sec-catchfinallyfunctions</span> Catch Finally Functions</h1>\n          <p>A Catch Finally function is an anonymous built-in function that has a [[Constructor]] and an [[OnFinally]] internal slot. The value of the [[Constructor]] internal slot is a <code>Promise</code>-like <emu-xref href=\"#constructor\"><a href=\"#constructor\">constructor</a></emu-xref> <emu-xref href=\"#function-object\"><a href=\"#function-object\">function object</a></emu-xref>, and the value of the [[OnFinally]] internal slot is a <emu-xref href=\"#function-object\"><a href=\"#function-object\">function object</a></emu-xref>.</p>\n          <p>When a Catch Finally function is called with argument <var>reason</var>, the following steps are taken:</p>\n          <emu-alg><ol><li>Let <var>F</var> be the <emu-xref href=\"#active-function-object\"><a href=\"#active-function-object\">active function object</a></emu-xref>.</li><li>Let <var>onFinally</var> be <var>F</var>.[[OnFinally]].</li><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <emu-xref aoid=\"IsCallable\"><a href=\"#sec-iscallable\">IsCallable</a></emu-xref>(<var>onFinally</var>) is <emu-val>true</emu-val>.</li><li>Let <var>result</var> be ?&#160;<emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>onFinally</var>, <emu-val>undefined</emu-val>).</li><li>Let <var>C</var> be <var>F</var>.[[Constructor]].</li><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <emu-xref aoid=\"IsConstructor\"><a href=\"#sec-isconstructor\">IsConstructor</a></emu-xref>(<var>C</var>) is <emu-val>true</emu-val>.</li><li>Let <var>promise</var> be ?&#160;<emu-xref aoid=\"PromiseResolve\"><a href=\"#sec-promise-resolve\">PromiseResolve</a></emu-xref>(<var>C</var>, <var>result</var>).</li><li>Let <var>thrower</var> be equivalent to a function that throws <var>reason</var>.</li><li>Return ?&#160;<emu-xref aoid=\"Invoke\"><a href=\"#sec-invoke\">Invoke</a></emu-xref>(<var>promise</var>, <emu-val>\"then\"</emu-val>, &#171; <var>thrower</var> &#187;).</li></ol></emu-alg>\n          <p>The <emu-val>\"length\"</emu-val> property of a Catch Finally function is <emu-val>1</emu-val><sub>&#120125;</sub>.</p>\n        </emu-clause>\n      "}, "sec-thenfinallyfunctions": {"num": "27.2.5.3.1", "title": "#sec-thenfinallyfunctions Then Finally Functions", "html": "<emu-clause id=\"sec-thenfinallyfunctions\">\n          <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-thenfinallyfunctions\">#sec-thenfinallyfunctions</span> Then Finally Functions</h1>\n          <p>A Then Finally function is an anonymous built-in function that has a [[Constructor]] and an [[OnFinally]] internal slot. The value of the [[Constructor]] internal slot is a <code>Promise</code>-like <emu-xref href=\"#constructor\"><a href=\"#constructor\">constructor</a></emu-xref> <emu-xref href=\"#function-object\"><a href=\"#function-object\">function object</a></emu-xref>, and the value of the [[OnFinally]] internal slot is a <emu-xref href=\"#function-object\"><a href=\"#function-object\">function object</a></emu-xref>.</p>\n          <p>When a Then Finally function is called with argument <var>value</var>, the following steps are taken:</p>\n          <emu-alg><ol><li>Let <var>F</var> be the <emu-xref href=\"#active-function-object\"><a href=\"#active-function-object\">active function object</a></emu-xref>.</li><li>Let <var>onFinally</var> be <var>F</var>.[[OnFinally]].</li><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <emu-xref aoid=\"IsCallable\"><a href=\"#sec-iscallable\">IsCallable</a></emu-xref>(<var>onFinally</var>) is <emu-val>true</emu-val>.</li><li>Let <var>result</var> be ?&#160;<emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>onFinally</var>, <emu-val>undefined</emu-val>).</li><li>Let <var>C</var> be <var>F</var>.[[Constructor]].</li><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <emu-xref aoid=\"IsConstructor\"><a href=\"#sec-isconstructor\">IsConstructor</a></emu-xref>(<var>C</var>) is <emu-val>true</emu-val>.</li><li>Let <var>promise</var> be ?&#160;<emu-xref aoid=\"PromiseResolve\"><a href=\"#sec-promise-resolve\">PromiseResolve</a></emu-xref>(<var>C</var>, <var>result</var>).</li><li>Let <var>valueThunk</var> be equivalent to a function that returns <var>value</var>.</li><li>Return ?&#160;<emu-xref aoid=\"Invoke\"><a href=\"#sec-invoke\">Invoke</a></emu-xref>(<var>promise</var>, <emu-val>\"then\"</emu-val>, &#171; <var>valueThunk</var> &#187;).</li></ol></emu-alg>\n          <p>The <emu-val>\"length\"</emu-val> property of a Then Finally function is <emu-val>1</emu-val><sub>&#120125;</sub>.</p>\n        </emu-clause>\n\n        "}}, "figData": {}}, "to": {"secList": ["sec-promise.prototype.finally"], "secData": {"sec-promise.prototype.finally": {"num": "27.2.5.3", "title": "#sec-promise.prototype.finally Promise.prototype.finally ( onFinally )", "html": "<emu-clause id=\"sec-promise.prototype.finally\" oldids=\"sec-thenfinallyfunctions,sec-catchfinallyfunctions\"><span id=\"sec-catchfinallyfunctions\"></span><span id=\"sec-thenfinallyfunctions\"></span>\n        <h1><span class=\"secnum excluded-secnum\" excluded-id=\"sec-promise.prototype.finally\">#sec-promise.prototype.finally</span> Promise.prototype.finally ( <var>onFinally</var> )</h1>\n        <p>When the <code>finally</code> method is called with argument <var>onFinally</var>, the following steps are taken:</p>\n        <emu-alg><ol><li>Let <var>promise</var> be the <emu-val>this</emu-val> value.</li><li>If <emu-xref aoid=\"Type\"><a href=\"#sec-ecmascript-data-types-and-values\">Type</a></emu-xref>(<var>promise</var>) is not Object, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>C</var> be ?&#160;<emu-xref aoid=\"SpeciesConstructor\"><a href=\"#sec-speciesconstructor\">SpeciesConstructor</a></emu-xref>(<var>promise</var>, <emu-xref href=\"#sec-promise-constructor\"><a href=\"#sec-promise-constructor\">%Promise%</a></emu-xref>).</li><li><emu-xref href=\"#assert\"><a href=\"#assert\">Assert</a></emu-xref>: <emu-xref aoid=\"IsConstructor\"><a href=\"#sec-isconstructor\">IsConstructor</a></emu-xref>(<var>C</var>) is <emu-val>true</emu-val>.</li><li>If <emu-xref aoid=\"IsCallable\"><a href=\"#sec-iscallable\">IsCallable</a></emu-xref>(<var>onFinally</var>) is <emu-val>false</emu-val>, then<ol><li>Let <var>thenFinally</var> be <var>onFinally</var>.</li><li>Let <var>catchFinally</var> be <var>onFinally</var>.</li></ol></li><li>Else,<ol><li>Let <var>thenFinallyClosure</var> be a new <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> with parameters (<var>value</var>) that captures <var>onFinally</var> and <var>C</var> and performs the following steps when called:<ol><li>Let <var>result</var> be ?&#160;<emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>onFinally</var>, <emu-val>undefined</emu-val>).</li><li>Let <var>promise</var> be ?&#160;<emu-xref aoid=\"PromiseResolve\"><a href=\"#sec-promise-resolve\">PromiseResolve</a></emu-xref>(<var>C</var>, <var>result</var>).</li><li>Let <var>returnValue</var> be a new <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> with no parameters that captures <var>value</var> and performs the following steps when called:<ol><li>Return <var>value</var>.</li></ol></li><li>Let <var>valueThunk</var> be !&#160;<emu-xref aoid=\"CreateBuiltinFunction\"><a href=\"#sec-createbuiltinfunction\">CreateBuiltinFunction</a></emu-xref>(<var>returnValue</var>, 0, <emu-val>\"\"</emu-val>, &#171; &#187;).</li><li>Return ?&#160;<emu-xref aoid=\"Invoke\"><a href=\"#sec-invoke\">Invoke</a></emu-xref>(<var>promise</var>, <emu-val>\"then\"</emu-val>, &#171; <var>valueThunk</var> &#187;).</li></ol></li><li>Let <var>thenFinally</var> be !&#160;<emu-xref aoid=\"CreateBuiltinFunction\"><a href=\"#sec-createbuiltinfunction\">CreateBuiltinFunction</a></emu-xref>(<var>thenFinallyClosure</var>, 1, <emu-val>\"\"</emu-val>, &#171; &#187;).</li><li>Let <var>catchFinallyClosure</var> be a new <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> with parameters (<var>reason</var>) that captures <var>onFinally</var> and <var>C</var> and performs the following steps when called:<ol><li>Let <var>result</var> be ?&#160;<emu-xref aoid=\"Call\"><a href=\"#sec-call\">Call</a></emu-xref>(<var>onFinally</var>, <emu-val>undefined</emu-val>).</li><li>Let <var>promise</var> be ?&#160;<emu-xref aoid=\"PromiseResolve\"><a href=\"#sec-promise-resolve\">PromiseResolve</a></emu-xref>(<var>C</var>, <var>result</var>).</li><li>Let <var>throwReason</var> be a new <emu-xref href=\"#sec-abstract-closure\"><a href=\"#sec-abstract-closure\">Abstract Closure</a></emu-xref> with no parameters that captures <var>reason</var> and performs the following steps when called:<ol><li>Return <emu-xref aoid=\"ThrowCompletion\"><a href=\"#sec-throwcompletion\">ThrowCompletion</a></emu-xref>(<var>reason</var>).</li></ol></li><li>Let <var>thrower</var> be !&#160;<emu-xref aoid=\"CreateBuiltinFunction\"><a href=\"#sec-createbuiltinfunction\">CreateBuiltinFunction</a></emu-xref>(<var>throwReason</var>, 0, <emu-val>\"\"</emu-val>, &#171; &#187;).</li><li>Return ?&#160;<emu-xref aoid=\"Invoke\"><a href=\"#sec-invoke\">Invoke</a></emu-xref>(<var>promise</var>, <emu-val>\"then\"</emu-val>, &#171; <var>thrower</var> &#187;).</li></ol></li><li>Let <var>catchFinally</var> be !&#160;<emu-xref aoid=\"CreateBuiltinFunction\"><a href=\"#sec-createbuiltinfunction\">CreateBuiltinFunction</a></emu-xref>(<var>catchFinallyClosure</var>, 1, <emu-val>\"\"</emu-val>, &#171; &#187;).</li></ol></li><li>Return ?&#160;<emu-xref aoid=\"Invoke\"><a href=\"#sec-invoke\">Invoke</a></emu-xref>(<var>promise</var>, <emu-val>\"then\"</emu-val>, &#171; <var>thenFinally</var>, <var>catchFinally</var> &#187;).</li></ol></emu-alg>\n      </emu-clause>\n\n      "}}, "figData": {}}}